(function(){var t={184:function(t,e,o){"use strict";o(750),o(6639),o(8803),o(5967);var i=o(4853),r=o(4679),a=o.n(r),n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"app"}},[o("div",{staticClass:"layout"},[o("Layout",[o("HeaderView"),o("MainView")],1)],1)])},s=[],l=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"header-view"},[o("Header",{staticClass:"header"},[o("Menu",{staticClass:"menu",attrs:{mode:"horizontal",theme:"light"}},[o("div",{staticClass:"layout-nav"},[o("Dropdown",{staticClass:"upload-img"},[o("Upload",{ref:"upload",attrs:{action:"#",multiple:!1,"show-upload-list":!1,"before-upload":t.loadImg,format:["jpg","jpeg","png"],accept:t.accept,"on-format-error":t.handleFormatError}},[o("div",{staticClass:"upload"},[o("Icon",{attrs:{type:"ios-add-circle-outline"}}),t._v(" 打开图片 ")],1)])],1),o("Dropdown",{staticClass:"reset-img"},[o("Button",{attrs:{type:"text"},on:{click:t.resetCurrentImg}},[o("Icon",{attrs:{type:"ios-crop"}}),t._v(" 重置修改 ")],1)],1),o("Dropdown",{staticClass:"crop-img"},[o("Button",{attrs:{type:"text"},on:{click:function(e){t.smartCropModalVal=!0}}},[o("Icon",{attrs:{type:"ios-crop"}}),t._v(" 裁剪图片 ")],1)],1),o("Dropdown",{staticClass:"replace-bg"},[o("Button",{attrs:{type:"text"},on:{click:function(e){t.backgroundReplaceModalVal=!0}}},[o("Icon",{attrs:{type:"ios-aperture-outline"}}),t._v(" 背景替换 ")],1)],1),o("Dropdown",{staticClass:"replace-bg"},[o("Button",{attrs:{type:"text"},on:{click:t.exportImg}},[o("Icon",{attrs:{type:"ios-cloud-download-outline"}}),t._v(" 导出下载 ")],1)],1)],1)])],1),o("SmartCrop",{model:{value:t.smartCropModalVal,callback:function(e){t.smartCropModalVal=e},expression:"smartCropModalVal"}}),o("BackgroundReplace",{model:{value:t.backgroundReplaceModalVal,callback:function(e){t.backgroundReplaceModalVal=e},expression:"backgroundReplaceModalVal"}})],1)},h=[],c=(o(2206),function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("Modal",{attrs:{draggable:"",sticky:"","reset-drag-position":!0,mask:!1,width:800,title:"智能裁剪","ok-text":"保存修改","cancel-text":"取消修改"},on:{"on-visible-change":t.handleVisibleChange,"on-ok":t.saveCropedImg,"on-cancel":t.closeModal},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[o("div",{staticClass:"img-cutter"},[o("div",{staticClass:"modal-left"},[o("ImgCutter",{ref:"imgCutterModal",attrs:{"is-modal":!1,"box-width":570,"box-height":400,"show-choose-btn":!1,"preview-mode":!0,"size-change":!0,"cut-width":200,"cut-height":280,rate:"10:14","auto-rotate":t.autoRotate},on:{cutDown:t.cutDown,onPrintImg:t.printImg,onClearAll:t.clearImg,error:t.error},scopedSlots:t._u([{key:"cancel",fn:function(){return[o("Button",{ref:"cancelButton",attrs:{type:"text",disabled:""}},[t._v(" 取消 ")])]},proxy:!0},{key:"confirm",fn:function(){return[o("Button",{ref:"cropButton",attrs:{type:"primary",disabled:""}},[t._v(" 裁剪 ")])]},proxy:!0}])})],1),o("div",{staticClass:"modal-right"},[o("div",{ref:"previewimg",staticClass:"preview-img"}),o("div",{staticClass:"right-button"},[o("Button",{ref:"autoRotateButton",staticClass:"right-button",attrs:{type:"primary",disabled:"",loading:t.loading},on:{click:t.smartRotate}},[t.loading?o("span",[t._v("处理中...")]):o("span",[t._v("自动矫正")])])],1)])])])}),d=[],g=o(3387),m=o(770),u=(o(1209),o(8718),o(5276)),p=o(8786),f=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[!0===t.showChooseBtn&&!0===t.isModal?o("div",{on:{click:t.handleOpen}},[t._t("openImgCutter"),t._t("open")],2):t._e(),t.$slots.openImgCutter||t.$slots.open||!0!==t.isModal?t._e():o("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.handleOpen}},[t._v(" "+t._s(t.label)+" ")]),o("transition",{attrs:{name:"fade"}},[t.visible?o("div",{ref:"mask",class:!0===t.isModal?"mask vue-img-cutter":""},[t.visible?o("div",{class:!0===t.isModal?"dialogBoxModal":"dialogBox"},[o("transition",{attrs:{name:"fade","enter-class":"fade-in-enter","enter-active-class":"fade-in-active","leave-class":"fade-out-enter","leave-active-class":"fade-out-active"}},[o("div",{ref:"dialogMainModalRef",class:!0===t.isModal?"dialogMainModal":"dialogMain",style:"width:"+(!0===t.isModal?t.boxWidth+32:t.boxWidth)+"px"},[o("div",{staticClass:"toolMain"},[!0===t.isModal?o("div",{staticClass:"tool-title"},[t._v(" 图片裁剪 "),o("span",{staticClass:"closeIcon",on:{click:t.handleClose}},[t._v("×")])]):t._e(),o("div",{ref:"toolBox",staticClass:"toolBox",style:"height:"+t.boxHeight+"px;width:"+t.boxWidth+"px",on:{mousemove:t.controlBtnMouseMove,mouseup:t.controlBtnMouseUp,mouseleave:t.controlBtnMouseUp}},[o("div",{directives:[{name:"show",rawName:"v-show",value:!t.drawImg.img&&!0===t.showChooseBtn,expression:"!drawImg.img && showChooseBtn === true"}],staticClass:"tips"},[o("div",{staticClass:"btn btn-warning btn-xs",on:{click:t.chooseImg}},[t._v(" "+t._s(t.label)+" ")])]),1==t.tool?o("div",{directives:[{name:"show",rawName:"v-show",value:t.drawImg.img&&!0!==t.dropImg.active&&1==t.controlBox.disable&&1==t.toolBox.disable,expression:"\n                    drawImg.img &&\n                      dropImg.active !== true &&\n                      controlBox.disable == true &&\n                      toolBox.disable == true\n                  "}],staticClass:"dockMain",style:"background:"+t.toolBgc,on:{mouseenter:t.dropImgOff}},[t.rate?o("div",{staticClass:"dockBtn"},[t._t("ratio",(function(){return[t._v(" Ratio: ")]})),t._v(" "+t._s(t.rate)+" ")],2):t._e(),o("div",{staticClass:"dockBtn",on:{click:t.scaleReset}},[t._t("scaleReset",(function(){return[t._v(" Scale: ")]})),t._v(" "+t._s(t.drawImg.swidth>0?(t.drawImg.width/t.drawImg.swidth).toFixed(2):"-")+" ")],2),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:function(e){return t.turnImg(-90)}}},[t._t("turnLeft",(function(){return[t._v(" ↳ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:function(e){return t.turnImg(90)}}},[t._t("turnRight",(function(){return[t._v(" ↲ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:function(e){return t.turnReset()}}},[t._t("reset",(function(){return[t._v(" ↻ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtnScrollBar"},[o("div",{ref:"dockBtnScrollControl",staticClass:"scrollBarControl",style:"left:"+t.rotateControl.position+"px",on:{mousemove:t.scrollBarControlMove,mousedown:t.scrollBarControlOn,mouseleave:t.scrollBarControlOff,mouseup:t.scrollBarControlOff}}),1==t.rotateControl.active?o("div",{staticClass:"scrollBarText",style:"left:"+t.rotateControl.position+"px"},[t._v(" "+t._s(t.rotateImg.angle.toFixed(0)+"°")+" ")]):t._e()]):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:t.flipHorizontal}},[t._t("flipHorizontal",(function(){return[t._v(" ⇆ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:t.flipVertically}},[t._t("turnRight",(function(){return[t._v(" ⇅ ")]}))],2):t._e()]):t._e(),o("div",{directives:[{name:"show",rawName:"v-show",value:null!=t.drawImg.img,expression:"drawImg.img != null"}],ref:"toolBoxControl",staticClass:"toolBoxControl",on:{mousedown:t.toolBoxMouseDown,mouseup:t.toolBoxMouseUp,mousemove:t.toolBoxMouseMove,mouseleave:t.toolBoxMouseLeave}},[o("div",{staticClass:"toolBoxControlBox"},[o("div",{staticClass:"controlBox"},[o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineTop"}),o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineBottom"}),o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineLeft"}),o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineRight"}),o("div",{staticClass:"selectArea"},[t._v(" 宽:"+t._s(t.showToolBoxWidth)+" 高:"+t._s(t.showToolBoxHeight)+" (x:"+t._s(t.showToolBoxX)+",y:"+t._s(t.showToolBoxY)+") ")]),!0===t.sizeChange?o("div",{staticClass:"leftUp controlBtn",attrs:{"data-name":"leftUp"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"leftUp")}}}):t._e(),!0===t.sizeChange?o("div",{staticClass:"leftDown controlBtn",attrs:{"data-name":"leftDown"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"leftDown")}}}):t._e(),!0===t.sizeChange?o("div",{staticClass:"rightUp controlBtn",attrs:{"data-name":"rightUp"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"rightUp")}}}):t._e(),!0===t.sizeChange?o("div",{staticClass:"rightDown controlBtn",attrs:{"data-name":"rightDown"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"rightDown")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.width>20?o("div",{staticClass:"topCenter controlBtn",attrs:{"data-name":"topCenter"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"topCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.width>20?o("div",{staticClass:"downCenter controlBtn",attrs:{"data-name":"downCenter"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"downCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.height>20?o("div",{staticClass:"leftCenter controlBtn",attrs:{"data-name":"leftCenter"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"leftCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.height>20?o("div",{staticClass:"rightCenter controlBtn",attrs:{"data-name":"rightCenter"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"rightCenter")}}}):t._e()]),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-1"}),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-2"}),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-3"}),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-4"})])]),o("div",{staticClass:"copyright"},[t.DoNotDisplayCopyright?t._e():o("a",{attrs:{target:"_blank",href:"https://github.com/acccccccb/vue-img-cutter",rel:"nofollow"}},[t._v(" vue-img-cutter "+t._s(t.version)+" ")])]),o("canvas",{ref:"canvasSelectBox",staticClass:"canvasSelectBox",attrs:{width:t.boxWidth,height:t.boxHeight},on:{mousedown:t.dropImgOn,mouseup:t.dropImgOff,mousemove:t.dropImgMove}}),o("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:t.boxWidth,height:t.boxHeight}})])]),o("div",{staticClass:"i-dialog-footer",staticStyle:{height:"40px"}},[o("input",{ref:"inputFile",staticStyle:{width:"1px",height:"1px",border:"none",opacity:"0"},attrs:{type:"file",accept:"image/gif, image/jpeg ,image/png"},on:{change:t.putImgToCanv}}),o("span",{on:{click:t.chooseImg}},[t._t("choose",(function(){return[!0===t.showChooseBtn?o("div",{staticClass:"btn btn-primary btn-primary-plain"},[t._v(" "+t._s(t.label)+" ")]):t._e()]}))],2),o("div",{staticClass:"btn-group fr"},[o("span",{on:{click:t.handleClose}},[t._t("cancel",(function(){return[o("button",{staticClass:"btn btn-default",attrs:{type:"button"}},[t._v("取消")])]}))],2),o("span",{on:{click:function(e){return t.cropPicture(!1)}}},[t._t("confirm",(function(){return[o("button",{staticClass:"btn btn-primary",staticStyle:{"margin-left":"15px"},attrs:{type:"button",disabled:!t.drawImg.img}},[t._v(" 确定 ")])]}))],2)])])])]),o("div",{staticStyle:{clear:"both"}})],1):t._e()]):t._e()])],1)},x=[],w=o(8387),v=(o(5514),o(4756),o(9966),o(9106),o(2366),o(9701),o(292),o(3541),o(5708),o(6394),o(5553),o(3691),o(8734),o(535),o(3926),o(4450),o(7623),o(7214),o(6391),o(4064),o(6582),o(1077),o(5328),o(7198),o(5452),o(1037),o(5341),o(3909),o(9490),o(5186),o(1937),o(9381),o(3431),o(3931),o(5113),o(4872),o(6073),{name:"vue-img-cutter",version:"3.0.1",description:"A image crop plug-in for Vue,you can use it to rotate、zoom images and cut any size",author:"acccccccb <tabzhang@foxmail.com>",private:!1,scripts:{serve:"vue-cli-service serve",build:"vue-cli-service build",lint:"vue-cli-service lint"},dependencies:{"core-js":"^3.20.3",vue:"^3.2.29"},devDependencies:{"@vue/cli-plugin-babel":"~4.5.15","@vue/cli-plugin-eslint":"~4.5.15","@vue/cli-service":"~4.5.15","@vue/compiler-sfc":"^3.2.29","babel-eslint":"^10.1.0",eslint:"^6.8.0","eslint-plugin-vue":"^7.20.0"},main:"./src/index.js",repository:{type:"git",url:"git+https://github.com/acccccccb/vue-img-cutter.git"},keywords:["image","crop","cutter","vue","裁剪"],license:"Apache2.0",bugs:{url:"https://github.com/acccccccb/vue-img-cutter/issues"},homepage:"https://ihtmlcss.com/demo/dist/#/croptool",eslintConfig:{root:!0,env:{node:!0},extends:["plugin:vue/vue3-essential","eslint:recommended"],parserOptions:{parser:"babel-eslint"},rules:{}},browserslist:["> 1%","last 2 versions","not dead"]}),I={name:"ImgCutter",model:["label","boxWidth","boxHeight","rate","tool","DoNotDisplayCopyright"],props:{crossOrigin:{type:Boolean,default:!1,required:!1},crossOriginHeader:{type:String,default:"*",required:!1},label:{type:String,default:"选择图片",required:!1},isModal:{type:Boolean,default:!0,required:!1},lockScroll:{type:Boolean,default:!0,required:!1},showChooseBtn:{type:Boolean,default:!0,required:!1},boxWidth:{type:Number,default:800,required:!1},boxHeight:{type:Number,default:400,required:!1},cutWidth:{type:Number,default:200,required:!1},cutHeight:{type:Number,default:200,required:!1},rate:{type:String,default:null,required:!1},tool:{type:Boolean,default:!0,required:!1},toolBgc:{type:String,default:"#fff",required:!1},imgMove:{type:Boolean,default:!0,required:!1},sizeChange:{type:Boolean,default:!0,required:!1},originalGraph:{type:Boolean,default:!1,required:!1},moveAble:{type:Boolean,default:!0,required:!1},previewMode:{type:Boolean,default:!0,required:!1},CuttingOriginal:{type:Boolean,default:!1,required:!1},WatermarkText:{type:String,default:"",required:!1},WatermarkTextFont:{type:String,default:"12px Sans-serif",required:!1},WatermarkTextColor:{type:String,default:"#fff",required:!1},WatermarkTextX:{type:Number,default:.95,required:!1},WatermarkTextY:{type:Number,default:.95,required:!1},smallToUpload:{type:Boolean,default:!1,required:!1},saveCutPosition:{type:Boolean,default:!1,required:!1},scaleAble:{type:Boolean,default:!0,required:!1},index:{default:null,required:!1},fileType:{default:"png",required:!1,type:String},toolBoxOverflow:{type:Boolean,default:!0,required:!1},DoNotDisplayCopyright:{type:Boolean,default:!1,required:!1},autoRotate:{type:Number,default:0,require:!1}},data:function(){var t,e;return t=this.boxWidth/2,e=this.boxHeight/2,{version:"",visible:!1,fileName:"",cutImageObj:null,onPrintImgTimmer:null,toolBoxPosition:{x:0,y:0},drawImg:{img:null,sx:0,sy:0,swidth:0,sheight:0,x:0,y:0,width:0,height:0},toolBox:{disable:!0,width:t,height:e,x:0,y:0,boxMove:{start:{x:0,y:0},moveTo:{x:0,y:0}}},dropImg:{active:!1,pageX:0,pageY:0,params:{}},rotateImg:{angle:0},rotateControl:{active:!1,start:{x:0,y:0},position:100},scaleImg:{rate:0,params:{}},controlBox:{disable:!0,btnName:"",start:{x:0,y:0,width:0,height:0}},selectBox:!1,selectBoxColor:"rgba(0,0,0,0.6)",isFlipHorizontal:!1,isFlipVertically:!1}},computed:{showToolBoxWidth:function(){var t;return t=this.originalGraph?this.toolBox.width/(this.drawImg.width/this.drawImg.swidth):this.toolBox.width,Number(t).toFixed(0)},showToolBoxHeight:function(){var t;return t=this.originalGraph?this.toolBox.height/(this.drawImg.width/this.drawImg.swidth):this.toolBox.height,Number(t).toFixed(0)},showToolBoxX:function(){var t;return t=this.toolBoxPosition.x,Number(t).toFixed(0)},showToolBoxY:function(){var t;return t=this.toolBoxPosition.y,Number(t).toFixed(0)}},watch:{autoRotate:function(t){this.autoTurnImg(t)}},mounted:function(){var t=this;this.version=v.version,!1===this.isModal&&(this.visible=!0,this.$nextTick((function(){t.$refs.toolBox&&(t.$refs.toolBox.onmousewheel=t.scaleImgWheel,t.$refs.toolBox.addEventListener("DOMMouseScroll",t.scaleImgWheel))})))},methods:{handleOpen:function(t){var e=this,o=function(t){if(e.$refs.toolBox&&(e.$refs.toolBox.onmousewheel=e.scaleImgWheel,e.$refs.toolBox.addEventListener("DOMMouseScroll",e.scaleImgWheel)),!0===e.isModal){!0===e.lockScroll&&(document.body.style.overflowY="hidden");var o=e.$refs.dialogMainModalRef.offsetHeight+200,i=window.innerHeight,r=e.$refs.mask;r.style.overflowY=o>i?"scroll":"hidden"}t&&"function"===typeof t&&t()};if(t&&"object"==(0,w.Z)(t)&&t.src){if(!t.name)throw new Error("传入参数必须包含：src,name");var i=new Image;!0===this.crossOrigin&&(i.crossOrigin=this.crossOriginHeader),i.name=t.name,i.style.position="fixed",i.style.top="".concat(-5e3,"px"),i.style.opacity=0,i.onerror=function(t){console.error("图片加载失败"),e.$emit("error",{index:e.index,event:t,msg:"图片加载失败"}),e.clearCutImageObj()},i.onload=function(){if(!0!==i.complete)throw new Error("图片加载失败");e.visible=!0,e.$nextTick((function(){o((function(){e.importImgToCanv(i)}))}))},i.src=t.src,this.cutImageObj=i,document.body.appendChild(i),this.$emit("onChooseImg",t,this.index)}else this.visible=!0,this.$nextTick((function(){o()}))},handleClose:function(){var t=this;this.clearAll(),!0===this.isModal&&(!0===this.lockScroll&&(document.body.style.overflowY="scroll"),this.$nextTick((function(){t.visible=!1})))},chooseImg:function(){this.$refs.inputFile.click()},importImgToCanv:function(t){var e,o=t.height,i=t.width,r=this.boxWidth,a=this.boxHeight,n=(0,m.Z)({},this.drawImg);this.fileName=t.name,n.img=t,this.scaleImg.rate=i/o,o<a&&i<r?(e=1,n.x=(r-i)/2,n.y=(a-o)/2):i/o<=r/a?(e=a/o,n.x=(r-i*e)/2):(e=r/i,n.y=(a-o*e)/2),n.swidth=i,n.sheight=o,n.width=i*e,n.height=o*e,n.x=(r-n.width)/2,n.y=(a-n.height)/2,this.drawImg=n,this.printImg(),this.putToolBox()},putImgToCanv:function(t){var e,o=this;if(!t.target.files)return console.error("IE9及以下需要自己传入image对象"),!1;if(e=t.target.files[0]||null,e){this.fileName=e.name;var i=new FileReader;i.readAsDataURL(e),i.onload=function(t){var r=t.target.result,a=document.createElement("img");a.src=r;var n=setInterval((function(){if(2===i.readyState){if(clearInterval(n),!o.sizeChange&&o.smallToUpload&&a.width<=o.cutWidth&&a.height<=o.cutHeight)return o.handleClose(),e.name=o.changeFileName(e.name,o.fileType),void o.$emit("cutDown",{filename:o.changeFileName(e.name,o.fileType),file:e,index:o.index});var t,r=a.height,s=a.width,l=o.boxWidth,h=o.boxHeight,c=(0,m.Z)({},o.drawImg);c.img=a,o.scaleImg.rate=s/r,r<h&&s<l?(t=1,c.x=(l-s)/2,c.y=(h-r)/2):s/r<=l/h?(t=h/r,c.x=(l-s*t)/2):(t=l/s,c.y=(h-r*t)/2),c.swidth=s,c.sheight=r,c.width=s*t,c.height=r*t,c.x=(l-c.width)/2,c.y=(h-c.height)/2,o.drawImg=c,o.printImg(),o.putToolBox()}}),200)},this.$emit("onChooseImg",e,this.index)}},putToolBox:function(){var t=this;this.toolBox.width!==this.boxWidth/2&&this.toolBox.height!==this.boxHeight/2&&!1!==this.saveCutPosition||(this.toolBox.width=this.cutWidth>this.boxWidth?this.boxWidth:this.cutWidth,this.toolBox.height=this.cutHeight>this.boxHeight?this.boxHeight:this.cutHeight),(0===this.toolBox.x&&0===this.toolBox.y||!1===this.saveCutPosition)&&(this.toolBox.x=this.boxWidth/2-this.toolBox.width/2,this.toolBox.y=this.boxHeight/2-this.toolBox.height/2),this.checkToolBoxOverflow().then((function(){t.printImg()})),this.drawControlBox(this.toolBox.width,this.toolBox.height,this.toolBox.x,this.toolBox.y)},checkToolBoxOverflow:function(){var t=this;return new Promise((function(e){if(!t.toolBoxOverflow){if(t.drawImg.width<t.toolBox.width||t.drawImg.height<t.toolBox.height){var o=t.drawImg.width/t.drawImg.height;t.drawImg.width<t.toolBox.width&&(t.drawImg.width=t.toolBox.width,t.drawImg.height=t.drawImg.width/o),t.drawImg.height<t.toolBox.height&&(t.drawImg.height=t.toolBox.height,t.drawImg.width=t.drawImg.height*o),t.drawImg.x=(t.boxWidth-t.drawImg.width)/2,t.drawImg.y=(t.boxHeight-t.drawImg.height)/2}console.log("this.drawImg.y > this.toolBox.y",t.drawImg.y+t.drawImg.height,t.toolBox.y+t.toolBox.height),t.drawImg.x>t.toolBox.x&&(t.drawImg.x=t.toolBox.x),t.drawImg.x+t.drawImg.width<t.toolBox.x+t.toolBox.width&&(t.drawImg.x=t.toolBox.x+t.toolBox.width-t.drawImg.width),t.drawImg.y>t.toolBox.y&&(t.drawImg.y=t.toolBox.y),t.drawImg.y+t.drawImg.height<t.toolBox.y+t.toolBox.height&&(t.drawImg.y=t.toolBox.y+t.toolBox.height-t.drawImg.height)}e()}))},isSupportFileApi:function(){return!(!(window.File&&window.FileList&&window.FileReader&&window.Blob)||navigator.userAgent.includes("Edge")||navigator.userAgent.includes("MSIE")||navigator.userAgent.includes("Trident"))},dataURLtoFile:function(t,e){var o=t.split(","),i=o[0].match(/:(.*?);/)[1],r=atob(o[1]),a=r.length,n=new Uint8Array(a);while(a--)n[a]=r.charCodeAt(a);if(this.isSupportFileApi()){var s=new File([n],e,{type:i});return s}return"不支持File对象"},clearAll:function(){var t=this,e=t.$refs.canvas,o=e.getContext("2d");o.clearRect(0,0,e.width,e.height);var i=t.$refs.canvasSelectBox,r=i.getContext("2d");r.clearRect(0,0,i.width,i.height);var a=t.drawImg.sx,n=t.drawImg.sy;this.drawImg={img:null,sx:a,sy:n,swidth:0,sheight:0,x:0,y:0,width:0,height:0},this.isFlipHorizontal=!1,this.isFlipVertically=!1,this.$refs.inputFile.value="",this.rotateImg.angle=0,this.drawImg.img=null,this.turnReset(),this.clearCutImageObj(),this.$emit("onClearAll",this.index)},clearCutImageObj:function(){null!==this.cutImageObj&&void 0!==this.cutImageObj&&("function"===typeof this.cutImageObj.remove?this.cutImageObj.remove():this.cutImageObj.removeNode()),this.cutImageObj=null},drawControlBox:function(t,e,o,i){var r=this;this.toolBoxOverflow||(t<1&&(t=1),e<1&&(e=1),t>this.drawImg.width&&(t=this.drawImg.width),e>this.drawImg.height&&(e=this.drawImg.height),o<this.drawImg.x&&(o=this.drawImg.x),i<this.drawImg.y&&(i=this.drawImg.y),o>this.drawImg.x+this.drawImg.width-t&&(o=this.drawImg.x+this.drawImg.width-t),i>this.drawImg.y+this.drawImg.height-e&&(i=this.drawImg.y+this.drawImg.height-e)),t>this.boxWidth&&(t=this.boxWidth),e>this.boxHeight&&(e=this.boxHeight),o<0&&(o=0),i<0&&(i=0);var a,n,s=this.$refs.toolBoxControl,l=this.$refs.canvasSelectBox,h=l.getContext("2d");if(h.fillStyle=this.selectBoxColor,h.clearRect(0,0,l.width,l.height),h.fillRect(0,0,l.width,l.height),this.rate&&""!==this.rate){var c=this.rate.split(":")[0]/this.rate.split(":")[1];c>=1?(a=t,n=t/c,n+i>this.drawImg.y+this.drawImg.height&&(n=this.drawImg.y+this.drawImg.height-i,a=n*c)):(a=e*c,n=e)}else a=t,n=e;this.toolBox.width=Math.abs(a),this.toolBox.height=Math.abs(n),s.style.width="".concat(Math.abs(a),"px"),s.style.height="".concat(Math.abs(n),"px"),this.toolBox.boxMove.moveTo.x=o,this.toolBox.boxMove.moveTo.y=i,a<0&&(o+=a),n<0&&(i+=n),o+this.toolBox.width>this.boxWidth&&(o=this.boxWidth-this.toolBox.width),o<0&&(o=0),i+this.toolBox.height>this.boxHeight&&(i=this.boxHeight-this.toolBox.height),i<0&&(i=0),this.toolBoxPosition.x=o,this.toolBoxPosition.y=i,s.style.left="".concat(o,"px"),s.style.top="".concat(i,"px"),h.clearRect(o,i,Math.abs(a),Math.abs(n)),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((function(){r.cropPicture(!0)}),100)},resetToolBox:function(){this.toolBox.width<0&&(this.toolBox.boxMove.moveTo.x=this.toolBox.x-this.toolBox.width),this.toolBox.height<0&&(this.toolBox.boxMove.moveTo.y=this.toolBox.y-this.toolBox.height),this.toolBox.width=Math.abs(this.toolBox.width),this.toolBox.height=Math.abs(this.toolBox.height)},toolBoxMouseDown:function(t){var e=this.$refs.toolBoxControl;this.toolBox.x=parseInt(e.style.left.split("px")[0]),this.toolBox.y=parseInt(e.style.top.split("px")[0]),this.toolBox.disable=!1,this.dropImg.active=!1,this.toolBox.boxMove.start={x:t.pageX,y:t.pageY}},toolBoxMouseMove:function(t){if(this.dropImg.active&&this.dropImgMove(t),!1===this.toolBox.disable&&!0===this.moveAble){var e=t.pageX-this.toolBox.boxMove.start.x,o=t.pageY-this.toolBox.boxMove.start.y,i=this.toolBox.x+e,r=this.toolBox.y+o;this.drawControlBox(this.toolBox.width,this.toolBox.height,i,r)}},toolBoxMouseLeave:function(){var t=this;this.toolBox.disable=!0,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((function(){t.cropPicture(!0)}),100),this.resetToolBox()},toolBoxMouseUp:function(){this.toolBox.x=parseInt(this.toolBoxPosition.x),this.toolBox.y=parseInt(this.toolBoxPosition.y),this.toolBox.disable=!0,this.dropImg.active=!1,this.resetToolBox()},printImg:function(){var t=this;if(this.drawImg.img){var e=this.$refs.canvas,o=e.getContext("2d");o.font="18px bold 黑体",o.fillStyle="#ff0",o.textAlign="center",o.textBaseline="middle",o.save(),o.clearRect(0,0,e.width,e.height),o.translate(this.drawImg.x+this.drawImg.width/2,this.drawImg.y+this.drawImg.height/2),o.rotate(this.rotateImg.angle*Math.PI/180),o.translate(-(this.drawImg.x+this.drawImg.width/2),-(this.drawImg.y+this.drawImg.height/2)),o.translate(this.drawImg.x,this.drawImg.y),o.scale(this.isFlipHorizontal?-1:1,this.isFlipVertically?-1:1),o.drawImage(this.drawImg.img,this.drawImg.sx,this.drawImg.sy,this.drawImg.swidth,this.drawImg.sheight,this.isFlipHorizontal?-this.drawImg.width:0,this.isFlipVertically?-this.drawImg.height:0,this.drawImg.width,this.drawImg.height),o.translate(-this.drawImg.x,this.drawImg.y),o.restore(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((function(){t.cropPicture(!0)}),100)}},dropImgOn:function(t){!0===this.imgMove&&(this.dropImg.active=!0,this.dropImg.params=(0,m.Z)({},this.drawImg),this.dropImg.pageX=t.pageX,this.dropImg.pageY=t.pageY)},dropImgOff:function(){var t=this;this.dropImg.active=!1,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((function(){t.cropPicture(!0)}),100)},dropImgMove:function(t){if(this.dropImg.active&&this.drawImg.img){var e=(0,m.Z)({},this.drawImg);e.x=this.dropImg.params.x-(this.dropImg.pageX-t.pageX),e.y=this.dropImg.params.y-(this.dropImg.pageY-t.pageY),this.toolBoxOverflow||(e.x>this.toolBox.x&&(e.x=this.toolBox.x),e.x<this.toolBox.x+this.toolBox.width-e.width&&(e.x=this.toolBox.x+this.toolBox.width-e.width),e.y>this.toolBox.y&&(e.y=this.toolBox.y),e.y<this.toolBox.y+this.toolBox.height-e.height&&(e.y=this.toolBox.y+this.toolBox.height-e.height)),this.drawImg=e,this.printImg(),t.stopPropagation()}},scaleReset:function(){this.drawImg.width=this.drawImg.swidth,this.drawImg.height=this.drawImg.sheight,this.printImg()},scaleImgWheel:function(t){var e=this;if(this.drawImg.img&&!0===this.scaleAble){var o,i=t||window.event;i.wheelDelta?o=-i.wheelDelta/40:i.detail&&(o=i.detail);var r=50;this.drawImg.x=this.drawImg.width-9*o>r?this.drawImg.x+3*o:this.drawImg.x,this.drawImg.y=this.drawImg.width-9*o>r?this.drawImg.y+3*o:this.drawImg.y,this.drawImg.width=this.drawImg.width-9*o>r?this.drawImg.width-9*o:r,this.drawImg.height=this.drawImg.width/this.scaleImg.rate,this.checkToolBoxOverflow().then((function(){e.printImg(),e.onPrintImgTimmer&&clearTimeout(e.onPrintImgTimmer),e.onPrintImgTimmer=setTimeout((function(){e.cropPicture(!0)}),100)}))}return t.preventDefault(),t.returnValue=!1,!1},flipHorizontal:function(){this.drawImg.img&&(0==this.isFlipHorizontal?this.isFlipHorizontal=!0:this.isFlipHorizontal=!1,this.printImg())},flipVertically:function(){this.drawImg.img&&(0==this.isFlipVertically?this.isFlipVertically=!0:this.isFlipVertically=!1,this.printImg())},turnImg:function(t){var e=this.rotateImg.angle,o=e+t;o>=-180&&o<=180&&(this.rotateImg.angle=o,this.rotateControl.position=o/180*100+100,this.printImg("rotate"))},autoTurnImg:function(t){var e=this.rotateImg.angle,o=e+t;o>=-180&&o<=180&&(this.rotateImg.angle=o,this.rotateControl.position=o/180*100+100,this.printImg("rotate"))},turnReset:function(){this.rotateImg.angle=0,this.rotateControl.position=100,this.printImg("rotate")},controlBtnMouseDown:function(t,e){this.controlBox.disable=!1,this.controlBox.btnName=e,this.controlBox.start.x=t.clientX,this.controlBox.start.y=t.clientY,this.controlBox.start.width=this.toolBox.width,this.controlBox.start.height=this.toolBox.height,t.stopPropagation()},controlBtnMouseUp:function(t){this.controlBox.disable=!0,this.dropImgOff(),this.resetToolBox(),this.toolBoxMouseUp(),t.stopPropagation()},controlBtnMouseMove:function(t){if(!1===this.controlBox.disable){var e,o,i=t.clientX-this.controlBox.start.x,r=t.clientY-this.controlBox.start.y;if("leftUp"==this.controlBox.btnName){if(this.rate){var a=this.rate.split(":")[0]/this.rate.split(":")[1];a>=1?(e=this.toolBox.x+i,o=this.toolBox.y+i/a):(e=this.toolBox.x+r*a,o=this.toolBox.y+r)}else e=this.toolBox.x+i,o=this.toolBox.y+r;this.toolBox.width=this.controlBox.start.width-i,this.toolBox.height=this.controlBox.start.height-r}if("rightUp"==this.controlBox.btnName){if(this.rate){var n=this.rate.split(":")[0]/this.rate.split(":")[1];n>=1?(e=this.toolBox.x,o=this.toolBox.y-i/n):(e=this.toolBox.x,o=this.toolBox.y+r)}else e=this.toolBox.x,o=this.toolBox.y+r;this.toolBox.width=this.controlBox.start.width+i,this.toolBox.height=this.controlBox.start.height-r}if("rightDown"==this.controlBox.btnName&&(e=this.toolBox.x,o=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+i,this.toolBox.height=this.controlBox.start.height+r),"leftDown"==this.controlBox.btnName){if(this.rate){var s=this.rate.split(":")[0]/this.rate.split(":")[1];s>=1?(e=this.toolBox.x+i,o=this.toolBox.y):(e=this.toolBox.x+-r*s,o=this.toolBox.y)}else e=this.toolBox.x+i,o=this.toolBox.y;this.toolBox.width=this.controlBox.start.width-i,this.toolBox.height=this.controlBox.start.height+r}"topCenter"==this.controlBox.btnName&&(e=this.toolBox.x,o=this.toolBox.y+r,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height-r),"downCenter"==this.controlBox.btnName&&(e=this.toolBox.x,o=this.toolBox.y,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height+r),"leftCenter"==this.controlBox.btnName&&(e=this.toolBox.x+i,o=this.toolBox.y,this.toolBox.width=this.controlBox.start.width-i,this.toolBox.height=this.controlBox.start.height),"rightCenter"==this.controlBox.btnName&&(e=this.toolBox.x,o=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+i,this.toolBox.height=this.controlBox.start.height),this.drawControlBox(this.toolBox.width,this.toolBox.height,e,o)}t.stopPropagation()},changeFileName:function(t,e){var o=t.lastIndexOf(".");return t.substr(0,o+1)+("jpeg"===e?"jpg":e)},cropPicture:function(t){var e=this;if(this.drawImg.img){var o=this.$refs.canvas;if(this.WatermarkText&&!t){var i=o.getContext("2d");i.font=this.WatermarkTextFont,i.fillStyle=this.WatermarkTextColor,i.textAlign="right",i.textBaseline="bottom",i.fillText(this.WatermarkText,this.toolBox.x+this.toolBox.width*this.WatermarkTextX,this.toolBox.y+this.toolBox.height*this.WatermarkTextY)}var r=new Image;!0===this.crossOrigin&&(r.crossOrigin=this.crossOriginHeader),r.src=o.toDataURL("image/".concat(this.fileType)),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,i,r){window.atob?setTimeout((function(){for(var a,n=atob(o.toDataURL(i,r).split(",")[1]),s=n.length,l=new Uint8Array(s),h=0;h<s;h++)l[h]=n.charCodeAt(h);try{a=new Blob([l],{type:"image/".concat(e.fileType)})}catch(g){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"==g.name&&window.BlobBuilder){var c=window.BlobBuilder,d=new c;d.append(l.buffer),a=d.getBlob("image/".concat(e.fileType))}"InvalidStateError"==g.name&&(a=new Blob([l.buffer],{type:"image/".concat(e.fileType)}))}t(a)}),200):t(!1,{type:"image/".concat(e.fileType)})}}),o.toBlob((function(o){if(o){var i=new FileReader;i.readAsDataURL(o),i.onload=function(){var o=setInterval((function(){if(2==i.readyState){clearInterval(o);var a=document.createElement("canvas"),n=a.getContext("2d");if(1==e.originalGraph){var s=e.drawImg.width/e.drawImg.swidth,l=e.toolBox.width/s,h=e.toolBox.height/s;a.width=l,a.height=h;var c=(e.toolBox.x-e.drawImg.x)/s,d=(e.toolBox.y-e.drawImg.y)/s,g=e.drawImg.swidth,m=e.drawImg.sheight;n.translate(-c,-d),n.drawImage(e.drawImg.img,0,0,g,m)}else{a.width=e.toolBox.width,a.height=e.toolBox.height;var u=e.toolBox;if(e.rate){var p=e.rate.split(":")[0]/e.rate.split(":")[1],f=e.rate.split(":")[0],x=e.rate.split(":")[1];f>=x?n.drawImage(r,u.x,u.y,u.width,u.width*p,0,0,u.width,u.width*p):n.drawImage(r,u.x,u.y,u.width,u.width/p,0,0,u.width,u.width/p)}else n.drawImage(r,u.x,u.y,u.width,u.height,0,0,u.width,u.height)}a.toBlob((function(o){var i=e.changeFileName(e.fileName,e.fileType);t?e.previewMode&&e.$emit("onPrintImg",{index:e.index,fileName:i,blob:o,file:e.dataURLtoFile(a.toDataURL("image/".concat(e.fileType)),i),dataURL:a.toDataURL("image/".concat(e.fileType))}):(e.handleClose(),e.$emit("cutDown",{index:e.index,fileName:i,blob:o,file:e.dataURLtoFile(a.toDataURL("image/".concat(e.fileType)),i),dataURL:a.toDataURL("image/".concat(e.fileType))}))}),"image/".concat(e.fileType),.95)}}),200)}}else{var a=document.createElement("canvas");a.width=e.toolBox.width,a.height=e.toolBox.height;var n=a.getContext("2d"),s=e.toolBox;if(e.rate){var l=e.rate.split(":")[0]/e.rate.split(":")[1];n.drawImage(r,s.x,s.y,s.width,s.width*l,0,0,s.width,s.width*l)}else n.drawImage(r,s.x,s.y,s.width,s.height,0,0,s.width,s.height);var h=e.changeFileName(e.fileName,e.fileType);t?e.$emit("onPrintImg",{fileName:h,dataURL:a.toDataURL("image/".concat(e.fileType))}):(e.handleClose(),e.$emit("cutDown",{fileName:h,dataURL:a.toDataURL("image/".concat(e.fileType))}))}})),"image/".concat(e.fileType)}else t||(console.warn("No picture selected"),e.$emit("error",{err:1,msg:"No picture selected"}))},scrollBarControlMove:function(t){if(this.rotateControl.active){var e=t.pageX-this.rotateControl.start.x,o=this.rotateControl.start.position+e;o<=0&&(o=0),o>=200&&(o=200),this.rotateControl.position=o,this.rotateImg.angle=(o-100)/100*180,this.printImg()}},scrollBarControlOn:function(t){this.rotateControl.active=!0,this.rotateControl.start.x=t.pageX,this.rotateControl.start.y=t.pageY,this.rotateControl.start.position=this.rotateControl.position},scrollBarControlOff:function(){this.rotateControl.active=!1}}},B=I,b=o(8e3),y=(0,b.Z)(B,f,x,!1,null,"35891e32",null),C=y.exports,M=C,_={name:"SmartCrop",components:{ImgCutter:M},model:{prop:"smartCropModalVal",event:"input"},props:["smartCropModalVal"],data:function(){return{showModal:!1,autoRotate:0,cutdownImgPreviewSrc:"",loading:!1}},watch:{smartCropModalVal:function(t){this.showModal=t},showModal:function(t){t&&this.$store.state.currentMainPreviewImgName&&(this.$refs.imgCutterModal.handleOpen({name:this.$store.state.currentMainPreviewImgName,src:this.getCurrentImgSrc}),this.$refs.cancelButton.$el.removeAttribute("disabled"),this.$refs.cropButton.$el.removeAttribute("disabled"),this.$refs.autoRotateButton.$el.removeAttribute("disabled"))}},computed:(0,m.Z)((0,m.Z)({},(0,p.rn)(["currentMainPreviewImgName"])),(0,p.Se)(["getCurrentImgSrc"])),mounted:function(){this.showModal=this.smartCropModalVal},methods:{handleVisibleChange:function(t){if(!1===t&&(this.$emit("input",t),this.autoRotate=0,this.$refs.cancelButton.$el.click(),this.cutdownImgPreviewSrc=""),!0===t)try{this.cutdownImgPreviewSrc=this.getCurrentImgSrc}catch(e){console.log()}},calcAng:function(t,e){if(e.y<=t.y&&e.x>=t.x){var o=Math.atan((t.y-e.y)/(e.x-t.x)),i=180*o/Math.PI;return i}if(e.y>=t.y&&t.x<e.x){var r=Math.atan((e.y-t.y)/(e.x-t.x)),a=180*r/Math.PI;return-a}},loadModel:function(){return(0,g.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u.qB.ssdMobilenetv1.loadFromUri("/idphotomaker/models/");case 2:return t.next=4,u.qB.faceLandmark68Net.loadFromUri("/idphotomaker/models/");case 4:case"end":return t.stop()}}),t)})))()},smartRotate:function(){var t=this;return(0,g.Z)(regeneratorRuntime.mark((function e(){var o,i,r,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,""!==t.cutdownImgPreviewSrc){e.next=3;break}throw new Error("没有选择图片");case 3:return o=new Image,o.src=t.cutdownImgPreviewSrc,t.loading=!0,e.next=8,t.loadModel();case 8:return e.next=10,u.bd(o).withFaceLandmarks();case 10:i=e.sent,r=i.landmarks,a=r.positions[36],n=r.positions[45],t.autoRotate=t.calcAng(a,n),t.loading=!1,t.$Message.success("自动矫正处理成功"),t.$refs.autoRotateButton.$el.setAttribute("disabled","false"),e.next=23;break;case 20:e.prev=20,e.t0=e["catch"](0),t.$Message.error("处理失败");case 23:case"end":return e.stop()}}),e,null,[[0,20]])})))()},cutDown:function(t){var e=document.createElement("img");e.setAttribute("width","160px"),e.setAttribute("height","225px"),e.src=t.dataURL,this.$refs.previewimg.appendChild(e),this.$refs.cancelButton.$el.setAttribute("disabled","true"),this.$refs.cropButton.$el.setAttribute("disabled","true"),this.$refs.autoRotateButton.$el.setAttribute("disabled","true")},printImg:function(t){var e=this.$refs.previewimg.firstChild;e||(e=document.createElement("img"),e.setAttribute("width","160px"),e.setAttribute("height","225px"),e.src=t.dataURL,this.$refs.previewimg.appendChild(e)),e.src=t.dataURL},clearImg:function(){var t=this.$refs.previewimg.firstChild;t&&t.remove(),this.cutdownImgPreviewSrc="",this.$refs.cancelButton.$el.setAttribute("disabled","true"),this.$refs.cropButton.$el.setAttribute("disabled","true"),this.$refs.autoRotateButton.$el.setAttribute("disabled","true")},error:function(t){"No picture selected"===t.msg&&this.$Message.error("未选择图片")},saveCropedImg:function(){var t=this.$refs.previewimg.firstChild;t?(this.$store.dispatch("updateImgData",{imgName:this.currentMainPreviewImgName,imgSrc:t.src}),this.$Message.success("保存修改成功")):this.$Message.error("未进行任何修改")},closeModal:function(){""!==this.currentMainPreviewImgName&&this.$Message.warning("未进行任何修改！")}}},T=_,k=(0,b.Z)(T,c,d,!1,null,"6f83c721",null),D=k.exports,$=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("Modal",{attrs:{draggable:"",sticky:"","reset-drag-position":!0,mask:!1,width:600,title:"智能替换背景","ok-text":"保存修改","cancel-text":"取消修改"},on:{"on-visible-change":t.handleVisibleChange,"on-ok":t.saveReplacedImg,"on-cancel":t.closeModal},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[t.getCurrentImgSrc?o("div",{staticClass:"background-replace"},[o("div",{staticClass:"left"},[o("img",{attrs:{src:t.getCurrentImgSrc,alt:"",width:"200",height:"280"}})]),o("div",{staticClass:"middle"},[o("canvas",{ref:"canvas",attrs:{id:"canvas",width:"200",height:"280"}})]),t.getCurrentImgSrc?o("div",{staticClass:"right"},[o("Button",{attrs:{type:"primary"},on:{click:function(e){return t.replaceBgColor("blue")}}},[t._v(" 换蓝色背景 ")]),o("Button",{attrs:{type:"error"},on:{click:function(e){return t.replaceBgColor("red")}}},[t._v(" 换红色背景 ")]),o("Button",{attrs:{type:"text"},on:{click:function(e){return t.replaceBgColor("white")}}},[t._v(" 换白色背景 ")])],1):t._e()]):o("h3",[t._v(" 请先选择图片 ")])])},N=[],S=o(9690),P=o.n(S),R=o(4330),O=o.n(R),F={api_key:"5Tv5VWWBYtPNtkB2c4l3MPbePwtg1qtx",api_secret:"_NlDutPsgZ6HmG_y_bO4It6_Bj8IXlTA",image_base64:"",return_grayscale:0},A={name:"BackgroundReplace",model:{prop:"backgroundReplaceModalVal",event:"input"},props:["backgroundReplaceModalVal"],data:function(){return{showModal:!1}},watch:{backgroundReplaceModalVal:function(t){this.showModal=t},currentMainPreviewImgName:function(){this.$refs.canvas&&this.$refs.canvas.getContext("2d").clearRect(0,0,200,280)}},mounted:function(){this.showModal=this.backgroundReplaceModalVal},computed:(0,m.Z)((0,m.Z)({},(0,p.rn)(["currentMainPreviewImgName"])),(0,p.Se)(["getCurrentImgSrc"])),methods:{handleVisibleChange:function(t){t||this.$emit("input",t)},closeModal:function(){""!==this.currentMainPreviewImgName&&this.$Message.warning("未进行任何修改！")},saveReplacedImg:function(){if(this.$refs.canvas&&!this.isCanvasBlank(this.$refs.canvas)){var t=this.$refs.canvas,e=t.toDataURL();this.$store.dispatch("updateImgData",{imgName:this.currentMainPreviewImgName,imgSrc:e}),this.$Message.success("背景替换成功"),this.$refs.canvas&&this.$refs.canvas.getContext("2d").clearRect(0,0,200,280)}else this.$Message.error("未进行任何修改！")},isCanvasBlank:function(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.toDataURL()===e.toDataURL()},requestFacePP:function(){var t=this;return(0,g.Z)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,F.image_base64=t.getCurrentImgSrc,e.next=4,P()({url:"https://api-cn.faceplusplus.com/humanbodypp/v2/segment",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:O().stringify(F)});case 4:if(o=e.sent,200!==o.status){e.next=9;break}return e.abrupt("return",o.data.body_image);case 9:throw new Error("背景替换失败");case 10:e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](0),t.$Message.error("背景替换失败");case 15:return e.prev=15,F.image_base64="",e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})))()},replaceBgColor:function(t){var e=this;return(0,g.Z)(regeneratorRuntime.mark((function o(){var i,r,a,n;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:i="",o.t0=t,o.next="blue"===o.t0?4:"red"===o.t0?6:"white"===o.t0?8:10;break;case 4:return i="#00BFF3",o.abrupt("break",10);case 6:return i="#FF0000",o.abrupt("break",10);case 8:return i="#FFFFFF",o.abrupt("break",10);case 10:return o.next=12,e.requestFacePP();case 12:r=o.sent,a="data:image/png;base64,".concat(r),n=new Image,n.src=a,n.width=200,n.height=280,n.onload=function(){var t=e.$refs.canvas,o=t.getContext("2d");o.fillStyle=i,o.fillRect(0,0,200,280),o.drawImage(n,0,0,200,280)};case 19:case"end":return o.stop()}}),o)})))()}}},L=A,U=(0,b.Z)(L,$,N,!1,null,"df7af7ac",null),H=U.exports,E={components:{SmartCrop:D,BackgroundReplace:H},data:function(){return{accept:"image/jpeg,image/jpg,image/png",smartCropModalVal:!1,backgroundReplaceModalVal:!1}},methods:{loadImg:function(t){var e=this,o=new FileReader;return o.readAsDataURL(t),o.onload=function(o){e.$store.dispatch("addImgData",{imgName:t.name,imgSrc:o.target.result}),e.$store.dispatch("changeCurrentImg",t.name),e.$refs.upload.clearFiles()},!1},handleFormatError:function(){console.log("文件不是图片")},resetCurrentImg:function(){""===this.$store.state.currentMainPreviewImgName?this.$Message.error("没有要重置的图片"):(this.$store.dispatch("resetCurrentImg"),this.$Message.success("重置成功！"))},exportImg:function(){var t=this.$store.getters.getCurrentImgSrc;if(t){var e=document.createElement("a"),o=new MouseEvent("click");e.download="导出.png",e.href=t,e.dispatchEvent(o)}else this.$Message.error("未选择图片")}}},W=E,V=(0,b.Z)(W,l,h,!1,null,"476914cb",null),q=V.exports,j=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("Layout",{staticClass:"main"},[o("Sider",{staticClass:"sider",attrs:{"hide-trigger":""}},[o("SiderPreviewCard")],1),o("Content",{staticClass:"content"},[o("MainPreviewCard")],1)],1)},Z=[],z=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",t._l(t.OriginImgData,(function(e){return o("Card",{key:e.imgName,staticClass:"card",attrs:{padding:5}},[o("div",{staticClass:"preview-img",staticStyle:{"text-align":"center"},on:{click:function(o){return t.changeMainPreview(e.imgName)}}},[o("img",{attrs:{src:e.imgSrc}})]),o("Tooltip",{staticClass:"remove-img",attrs:{content:"点击删除此照片",placement:"right",theme:"light"}},[o("Button",{attrs:{type:"text",size:"large",icon:"ios-trash"},on:{click:function(o){return t.removeImg(e.imgName)}}})],1)],1)})),1)},G=[],Y={name:"PreviewCard",computed:(0,m.Z)((0,m.Z)({},(0,p.rn)(["OriginImgData"])),{},{OriginImgDataList:function(){return this.OriginImgData?this.OriginImgData:[]}}),methods:{removeImg:function(t){this.$store.dispatch("removeImg",t)},changeMainPreview:function(t){this.$store.dispatch("changeCurrentImg",t)}}},X=Y,J=(0,b.Z)(X,z,G,!1,null,"d843d828",null),K=J.exports,Q=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"show-img"}},[0!=t.ModifiedImgData.length?o("img",{attrs:{src:t.getCurrentImgSrc,alt:""}}):t._e()])},tt=[],et={name:"MainPreviewCard",computed:(0,m.Z)((0,m.Z)({},(0,p.rn)(["ModifiedImgData"])),(0,p.Se)(["getCurrentImgSrc"]))},ot=et,it=(0,b.Z)(ot,Q,tt,!1,null,"49758519",null),rt=it.exports,at={components:{SiderPreviewCard:K,MainPreviewCard:rt}},nt=at,st=(0,b.Z)(nt,j,Z,!1,null,"4ba4d24c",null),lt=st.exports,ht={components:{HeaderView:q,MainView:lt}},ct=ht,dt=(0,b.Z)(ct,n,s,!1,null,"f8b444ba",null),gt=dt.exports;o(7217),o(4692),o(2914),o(619),o(5712);i["default"].use(p.ZP);var mt=new p.ZP.Store({state:{OriginImgData:JSON.parse(localStorage.getItem("OriginImgData"))||[],ModifiedImgData:JSON.parse(localStorage.getItem("ModifiedImgData"))||[],currentMainPreviewImgName:localStorage.getItem("currentMainPreviewImgName")||""},getters:{getCurrentImgSrc:function(t){return t.ModifiedImgData.length>0?t.ModifiedImgData.find((function(e){return e.imgName===t.currentMainPreviewImgName})).imgSrc:""}},mutations:{ADD_IMG_DATA:function(t,e){t.OriginImgData.push(e),t.ModifiedImgData.push(e),localStorage.setItem("OriginImgData",JSON.stringify(t.OriginImgData)),localStorage.setItem("ModifiedImgData",JSON.stringify(t.ModifiedImgData))},RM_IMG_DATA:function(t,e){t.OriginImgData.length>1?(t.OriginImgData=t.OriginImgData.filter((function(t){return t.imgName!==e})),t.ModifiedImgData=t.ModifiedImgData.filter((function(t){return t.imgName!==e})),t.currentMainPreviewImgName===e&&(t.currentMainPreviewImgName=t.OriginImgData[t.OriginImgData.length-1].imgName),localStorage.setItem("OriginImgData",JSON.stringify(t.OriginImgData)),localStorage.setItem("ModifiedImgData",JSON.stringify(t.ModifiedImgData)),localStorage.setItem("currentMainPreviewImgName",t.currentMainPreviewImgName)):(t.OriginImgData=[],t.ModifiedImgData=[],t.currentMainPreviewImgName="",localStorage.removeItem("OriginImgData"),localStorage.removeItem("ModifiedImgData"),localStorage.removeItem("currentMainPreviewImgName"))},UPDATE_IMG_DATA:function(t,e){var o=t.ModifiedImgData.findIndex((function(t){return t.imgName===e.imgName}));t.ModifiedImgData.splice(o,1,e),localStorage.setItem("ModifiedImgData",JSON.stringify(t.ModifiedImgData))},CHANGE_CURRENT_IMG:function(t,e){t.currentMainPreviewImgName=e,localStorage.setItem("currentMainPreviewImgName",t.currentMainPreviewImgName)},RESET_CURRENT_IMG:function(t){if(t.ModifiedImgData.length>0){var e=t.OriginImgData.find((function(e){return e.imgName===t.currentMainPreviewImgName})),o=t.ModifiedImgData.findIndex((function(e){return e.imgName===t.currentMainPreviewImgName}));t.ModifiedImgData.splice(o,1,e)}localStorage.setItem("ModifiedImgData",JSON.stringify(t.ModifiedImgData))}},actions:{addImgData:function(t,e){var o=t.commit;o("ADD_IMG_DATA",e)},updateImgData:function(t,e){var o=t.commit;o("UPDATE_IMG_DATA",e)},changeCurrentImg:function(t,e){var o=t.commit;o("CHANGE_CURRENT_IMG",e)},removeImg:function(t,e){var o=t.commit;o("RM_IMG_DATA",e)},resetCurrentImg:function(t){var e=t.commit;e("RESET_CURRENT_IMG")}},modules:{}});i["default"].use(a()),i["default"].config.productionTip=!1,new i["default"]({store:mt,render:function(t){return t(gt)}}).$mount("#app")},9771:function(){},3050:function(){},8450:function(){}},e={};function o(i){var r=e[i];if(void 0!==r)return r.exports;var a=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}o.m=t,function(){var t=[];o.O=function(e,i,r,a){if(!i){var n=1/0;for(c=0;c<t.length;c++){i=t[c][0],r=t[c][1],a=t[c][2];for(var s=!0,l=0;l<i.length;l++)(!1&a||n>=a)&&Object.keys(o.O).every((function(t){return o.O[t](i[l])}))?i.splice(l--,1):(s=!1,a<n&&(n=a));if(s){t.splice(c--,1);var h=r();void 0!==h&&(e=h)}}return e}a=a||0;for(var c=t.length;c>0&&t[c-1][2]>a;c--)t[c]=t[c-1];t[c]=[i,r,a]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){o.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};o.O.j=function(e){return 0===t[e]};var e=function(e,i){var r,a,n=i[0],s=i[1],l=i[2],h=0;if(n.some((function(e){return 0!==t[e]}))){for(r in s)o.o(s,r)&&(o.m[r]=s[r]);if(l)var c=l(o)}for(e&&e(i);h<n.length;h++)a=n[h],o.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return o.O(c)},i=self["webpackChunkidphotomaker"]=self["webpackChunkidphotomaker"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=o.O(void 0,[998],(function(){return o(184)}));i=o.O(i)})();
//# sourceMappingURL=app-legacy.f6c4dc68.js.map