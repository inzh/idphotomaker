(function(){var t={625:function(t,e,o){"use strict";var i=o(5702),s=o(7478),a=o.n(s),r=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"app"}},[o("div",{staticClass:"layout"},[o("Layout",[o("HeaderView"),o("MainView")],1)],1)])},n=[],l=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"header-view"},[o("Header",{staticClass:"header"},[o("Menu",{staticClass:"menu",attrs:{mode:"horizontal",theme:"light"}},[o("div",{staticClass:"layout-nav"},[o("Dropdown",{staticClass:"upload-img"},[o("Upload",{ref:"upload",attrs:{action:"#",multiple:!1,"show-upload-list":!1,"before-upload":t.loadImg,format:["jpg","jpeg","png"],accept:t.accept,"on-format-error":t.handleFormatError}},[o("div",{staticClass:"upload"},[o("Icon",{attrs:{type:"ios-add-circle-outline"}}),t._v(" 打开图片 ")],1)])],1),o("Dropdown",{staticClass:"reset-img"},[o("Button",{attrs:{type:"text"},on:{click:t.resetCurrentImg}},[o("Icon",{attrs:{type:"ios-crop"}}),t._v(" 重置修改 ")],1)],1),o("Dropdown",{staticClass:"crop-img"},[o("Button",{attrs:{type:"text"},on:{click:function(e){t.smartCropModalVal=!0}}},[o("Icon",{attrs:{type:"ios-crop"}}),t._v(" 裁剪图片 ")],1)],1),o("Dropdown",{staticClass:"replace-bg"},[o("Button",{attrs:{type:"text"},on:{click:function(e){t.backgroundReplaceModalVal=!0}}},[o("Icon",{attrs:{type:"ios-aperture-outline"}}),t._v(" 背景替换 ")],1)],1),o("Dropdown",{staticClass:"replace-bg"},[o("Button",{attrs:{type:"text"},on:{click:t.exportImg}},[o("Icon",{attrs:{type:"ios-cloud-download-outline"}}),t._v(" 导出下载 ")],1)],1)],1)])],1),o("SmartCrop",{model:{value:t.smartCropModalVal,callback:function(e){t.smartCropModalVal=e},expression:"smartCropModalVal"}}),o("BackgroundReplace",{model:{value:t.backgroundReplaceModalVal,callback:function(e){t.backgroundReplaceModalVal=e},expression:"backgroundReplaceModalVal"}})],1)},h=[],d=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("Modal",{attrs:{draggable:"",sticky:"","reset-drag-position":!0,mask:!1,width:800,title:"智能裁剪","ok-text":"保存修改","cancel-text":"取消修改"},on:{"on-visible-change":t.handleVisibleChange,"on-ok":t.saveCropedImg,"on-cancel":t.closeModal},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[o("div",{staticClass:"img-cutter"},[o("div",{staticClass:"modal-left"},[o("ImgCutter",{ref:"imgCutterModal",attrs:{"is-modal":!1,"box-width":570,"box-height":400,"show-choose-btn":!1,"preview-mode":!0,"size-change":!0,"cut-width":200,"cut-height":280,rate:"10:14","auto-rotate":t.autoRotate},on:{cutDown:t.cutDown,onPrintImg:t.printImg,onClearAll:t.clearImg,error:t.error},scopedSlots:t._u([{key:"cancel",fn:function(){return[o("Button",{ref:"cancelButton",attrs:{type:"text",disabled:""}},[t._v(" 取消 ")])]},proxy:!0},{key:"confirm",fn:function(){return[o("Button",{ref:"cropButton",attrs:{type:"primary",disabled:""}},[t._v(" 裁剪 ")])]},proxy:!0}])})],1),o("div",{staticClass:"modal-right"},[o("div",{ref:"previewimg",staticClass:"preview-img"}),o("div",{staticClass:"right-button"},[o("Button",{ref:"autoRotateButton",staticClass:"right-button",attrs:{type:"primary",disabled:"",loading:t.loading},on:{click:t.smartRotate}},[t.loading?o("span",[t._v("处理中...")]):o("span",[t._v("自动矫正")])])],1)])])])},c=[],g=(o(1209),o(5640)),m=o(8906),u=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[!0===t.showChooseBtn&&!0===t.isModal?o("div",{on:{click:t.handleOpen}},[t._t("openImgCutter"),t._t("open")],2):t._e(),t.$slots.openImgCutter||t.$slots.open||!0!==t.isModal?t._e():o("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.handleOpen}},[t._v(" "+t._s(t.label)+" ")]),o("transition",{attrs:{name:"fade"}},[t.visible?o("div",{ref:"mask",class:!0===t.isModal?"mask vue-img-cutter":""},[t.visible?o("div",{class:!0===t.isModal?"dialogBoxModal":"dialogBox"},[o("transition",{attrs:{name:"fade","enter-class":"fade-in-enter","enter-active-class":"fade-in-active","leave-class":"fade-out-enter","leave-active-class":"fade-out-active"}},[o("div",{ref:"dialogMainModalRef",class:!0===t.isModal?"dialogMainModal":"dialogMain",style:"width:"+(!0===t.isModal?t.boxWidth+32:t.boxWidth)+"px"},[o("div",{staticClass:"toolMain"},[!0===t.isModal?o("div",{staticClass:"tool-title"},[t._v(" 图片裁剪 "),o("span",{staticClass:"closeIcon",on:{click:t.handleClose}},[t._v("×")])]):t._e(),o("div",{ref:"toolBox",staticClass:"toolBox",style:"height:"+t.boxHeight+"px;width:"+t.boxWidth+"px",on:{mousemove:t.controlBtnMouseMove,mouseup:t.controlBtnMouseUp,mouseleave:t.controlBtnMouseUp}},[o("div",{directives:[{name:"show",rawName:"v-show",value:!t.drawImg.img&&!0===t.showChooseBtn,expression:"!drawImg.img && showChooseBtn === true"}],staticClass:"tips"},[o("div",{staticClass:"btn btn-warning btn-xs",on:{click:t.chooseImg}},[t._v(" "+t._s(t.label)+" ")])]),1==t.tool?o("div",{directives:[{name:"show",rawName:"v-show",value:t.drawImg.img&&!0!==t.dropImg.active&&1==t.controlBox.disable&&1==t.toolBox.disable,expression:"\n                    drawImg.img &&\n                      dropImg.active !== true &&\n                      controlBox.disable == true &&\n                      toolBox.disable == true\n                  "}],staticClass:"dockMain",style:"background:"+t.toolBgc,on:{mouseenter:t.dropImgOff}},[t.rate?o("div",{staticClass:"dockBtn"},[t._t("ratio",(function(){return[t._v(" Ratio: ")]})),t._v(" "+t._s(t.rate)+" ")],2):t._e(),o("div",{staticClass:"dockBtn",on:{click:t.scaleReset}},[t._t("scaleReset",(function(){return[t._v(" Scale: ")]})),t._v(" "+t._s(t.drawImg.swidth>0?(t.drawImg.width/t.drawImg.swidth).toFixed(2):"-")+" ")],2),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:function(e){return t.turnImg(-90)}}},[t._t("turnLeft",(function(){return[t._v(" ↳ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:function(e){return t.turnImg(90)}}},[t._t("turnRight",(function(){return[t._v(" ↲ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:function(e){return t.turnReset()}}},[t._t("reset",(function(){return[t._v(" ↻ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtnScrollBar"},[o("div",{ref:"dockBtnScrollControl",staticClass:"scrollBarControl",style:"left:"+t.rotateControl.position+"px",on:{mousemove:t.scrollBarControlMove,mousedown:t.scrollBarControlOn,mouseleave:t.scrollBarControlOff,mouseup:t.scrollBarControlOff}}),1==t.rotateControl.active?o("div",{staticClass:"scrollBarText",style:"left:"+t.rotateControl.position+"px"},[t._v(" "+t._s(t.rotateImg.angle.toFixed(0)+"°")+" ")]):t._e()]):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:t.flipHorizontal}},[t._t("flipHorizontal",(function(){return[t._v(" ⇆ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:t.flipVertically}},[t._t("turnRight",(function(){return[t._v(" ⇅ ")]}))],2):t._e()]):t._e(),o("div",{directives:[{name:"show",rawName:"v-show",value:null!=t.drawImg.img,expression:"drawImg.img != null"}],ref:"toolBoxControl",staticClass:"toolBoxControl",on:{mousedown:t.toolBoxMouseDown,mouseup:t.toolBoxMouseUp,mousemove:t.toolBoxMouseMove,mouseleave:t.toolBoxMouseLeave}},[o("div",{staticClass:"toolBoxControlBox"},[o("div",{staticClass:"controlBox"},[o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineTop"}),o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineBottom"}),o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineLeft"}),o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineRight"}),o("div",{staticClass:"selectArea"},[t._v(" 宽:"+t._s(t.showToolBoxWidth)+" 高:"+t._s(t.showToolBoxHeight)+" (x:"+t._s(t.showToolBoxX)+",y:"+t._s(t.showToolBoxY)+") ")]),!0===t.sizeChange?o("div",{staticClass:"leftUp controlBtn",attrs:{"data-name":"leftUp"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"leftUp")}}}):t._e(),!0===t.sizeChange?o("div",{staticClass:"leftDown controlBtn",attrs:{"data-name":"leftDown"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"leftDown")}}}):t._e(),!0===t.sizeChange?o("div",{staticClass:"rightUp controlBtn",attrs:{"data-name":"rightUp"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"rightUp")}}}):t._e(),!0===t.sizeChange?o("div",{staticClass:"rightDown controlBtn",attrs:{"data-name":"rightDown"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"rightDown")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.width>20?o("div",{staticClass:"topCenter controlBtn",attrs:{"data-name":"topCenter"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"topCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.width>20?o("div",{staticClass:"downCenter controlBtn",attrs:{"data-name":"downCenter"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"downCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.height>20?o("div",{staticClass:"leftCenter controlBtn",attrs:{"data-name":"leftCenter"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"leftCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.height>20?o("div",{staticClass:"rightCenter controlBtn",attrs:{"data-name":"rightCenter"},on:{mousedown:function(e){return t.controlBtnMouseDown(e,"rightCenter")}}}):t._e()]),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-1"}),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-2"}),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-3"}),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-4"})])]),o("div",{staticClass:"copyright"},[t.DoNotDisplayCopyright?t._e():o("a",{attrs:{target:"_blank",href:"https://github.com/acccccccb/vue-img-cutter",rel:"nofollow"}},[t._v(" vue-img-cutter "+t._s(t.version)+" ")])]),o("canvas",{ref:"canvasSelectBox",staticClass:"canvasSelectBox",attrs:{width:t.boxWidth,height:t.boxHeight},on:{mousedown:t.dropImgOn,mouseup:t.dropImgOff,mousemove:t.dropImgMove}}),o("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:t.boxWidth,height:t.boxHeight}})])]),o("div",{staticClass:"i-dialog-footer",staticStyle:{height:"40px"}},[o("input",{ref:"inputFile",staticStyle:{width:"1px",height:"1px",border:"none",opacity:"0"},attrs:{type:"file",accept:"image/gif, image/jpeg ,image/png"},on:{change:t.putImgToCanv}}),o("span",{on:{click:t.chooseImg}},[t._t("choose",(function(){return[!0===t.showChooseBtn?o("div",{staticClass:"btn btn-primary btn-primary-plain"},[t._v(" "+t._s(t.label)+" ")]):t._e()]}))],2),o("div",{staticClass:"btn-group fr"},[o("span",{on:{click:t.handleClose}},[t._t("cancel",(function(){return[o("button",{staticClass:"btn btn-default",attrs:{type:"button"}},[t._v("取消")])]}))],2),o("span",{on:{click:function(e){return t.cropPicture(!1)}}},[t._t("confirm",(function(){return[o("button",{staticClass:"btn btn-primary",staticStyle:{"margin-left":"15px"},attrs:{type:"button",disabled:!t.drawImg.img}},[t._v(" 确定 ")])]}))],2)])])])]),o("div",{staticStyle:{clear:"both"}})],1):t._e()]):t._e()])],1)},p=[];o(5553),o(535),o(1937);const x={name:"vue-img-cutter",version:"3.0.1",description:"A image crop plug-in for Vue,you can use it to rotate、zoom images and cut any size",author:"acccccccb <tabzhang@foxmail.com>",private:!1,scripts:{serve:"vue-cli-service serve",build:"vue-cli-service build",lint:"vue-cli-service lint"},dependencies:{"core-js":"^3.20.3",vue:"^3.2.29"},devDependencies:{"@vue/cli-plugin-babel":"~4.5.15","@vue/cli-plugin-eslint":"~4.5.15","@vue/cli-service":"~4.5.15","@vue/compiler-sfc":"^3.2.29","babel-eslint":"^10.1.0",eslint:"^6.8.0","eslint-plugin-vue":"^7.20.0"},main:"./src/index.js",repository:{type:"git",url:"git+https://github.com/acccccccb/vue-img-cutter.git"},keywords:["image","crop","cutter","vue","裁剪"],license:"Apache2.0",bugs:{url:"https://github.com/acccccccb/vue-img-cutter/issues"},homepage:"https://ihtmlcss.com/demo/dist/#/croptool",eslintConfig:{root:!0,env:{node:!0},extends:["plugin:vue/vue3-essential","eslint:recommended"],parserOptions:{parser:"babel-eslint"},rules:{}},browserslist:["> 1%","last 2 versions","not dead"]};var w={name:"ImgCutter",model:["label","boxWidth","boxHeight","rate","tool","DoNotDisplayCopyright"],props:{crossOrigin:{type:Boolean,default:!1,required:!1},crossOriginHeader:{type:String,default:"*",required:!1},label:{type:String,default:"选择图片",required:!1},isModal:{type:Boolean,default:!0,required:!1},lockScroll:{type:Boolean,default:!0,required:!1},showChooseBtn:{type:Boolean,default:!0,required:!1},boxWidth:{type:Number,default:800,required:!1},boxHeight:{type:Number,default:400,required:!1},cutWidth:{type:Number,default:200,required:!1},cutHeight:{type:Number,default:200,required:!1},rate:{type:String,default:null,required:!1},tool:{type:Boolean,default:!0,required:!1},toolBgc:{type:String,default:"#fff",required:!1},imgMove:{type:Boolean,default:!0,required:!1},sizeChange:{type:Boolean,default:!0,required:!1},originalGraph:{type:Boolean,default:!1,required:!1},moveAble:{type:Boolean,default:!0,required:!1},previewMode:{type:Boolean,default:!0,required:!1},CuttingOriginal:{type:Boolean,default:!1,required:!1},WatermarkText:{type:String,default:"",required:!1},WatermarkTextFont:{type:String,default:"12px Sans-serif",required:!1},WatermarkTextColor:{type:String,default:"#fff",required:!1},WatermarkTextX:{type:Number,default:.95,required:!1},WatermarkTextY:{type:Number,default:.95,required:!1},smallToUpload:{type:Boolean,default:!1,required:!1},saveCutPosition:{type:Boolean,default:!1,required:!1},scaleAble:{type:Boolean,default:!0,required:!1},index:{default:null,required:!1},fileType:{default:"png",required:!1,type:String},toolBoxOverflow:{type:Boolean,default:!0,required:!1},DoNotDisplayCopyright:{type:Boolean,default:!1,required:!1},autoRotate:{type:Number,default:0,require:!1}},data(){let t,e;return t=this.boxWidth/2,e=this.boxHeight/2,{version:"",visible:!1,fileName:"",cutImageObj:null,onPrintImgTimmer:null,toolBoxPosition:{x:0,y:0},drawImg:{img:null,sx:0,sy:0,swidth:0,sheight:0,x:0,y:0,width:0,height:0},toolBox:{disable:!0,width:t,height:e,x:0,y:0,boxMove:{start:{x:0,y:0},moveTo:{x:0,y:0}}},dropImg:{active:!1,pageX:0,pageY:0,params:{}},rotateImg:{angle:0},rotateControl:{active:!1,start:{x:0,y:0},position:100},scaleImg:{rate:0,params:{}},controlBox:{disable:!0,btnName:"",start:{x:0,y:0,width:0,height:0}},selectBox:!1,selectBoxColor:"rgba(0,0,0,0.6)",isFlipHorizontal:!1,isFlipVertically:!1}},computed:{showToolBoxWidth(){let t;return t=this.originalGraph?this.toolBox.width/(this.drawImg.width/this.drawImg.swidth):this.toolBox.width,Number(t).toFixed(0)},showToolBoxHeight(){let t;return t=this.originalGraph?this.toolBox.height/(this.drawImg.width/this.drawImg.swidth):this.toolBox.height,Number(t).toFixed(0)},showToolBoxX(){let t;return t=this.toolBoxPosition.x,Number(t).toFixed(0)},showToolBoxY(){let t;return t=this.toolBoxPosition.y,Number(t).toFixed(0)}},watch:{autoRotate(t){this.autoTurnImg(t)}},mounted(){this.version=x.version,!1===this.isModal&&(this.visible=!0,this.$nextTick((()=>{this.$refs.toolBox&&(this.$refs.toolBox.onmousewheel=this.scaleImgWheel,this.$refs.toolBox.addEventListener("DOMMouseScroll",this.scaleImgWheel))})))},methods:{handleOpen(t){const e=t=>{if(this.$refs.toolBox&&(this.$refs.toolBox.onmousewheel=this.scaleImgWheel,this.$refs.toolBox.addEventListener("DOMMouseScroll",this.scaleImgWheel)),!0===this.isModal){!0===this.lockScroll&&(document.body.style.overflowY="hidden");const t=this.$refs.dialogMainModalRef.offsetHeight+200,e=window.innerHeight,o=this.$refs.mask;o.style.overflowY=t>e?"scroll":"hidden"}t&&"function"===typeof t&&t()};if(t&&"object"==typeof t&&t.src){if(!t.name)throw new Error("传入参数必须包含：src,name");{const o=new Image;!0===this.crossOrigin&&(o.crossOrigin=this.crossOriginHeader),o.name=t.name,o.style.position="fixed",o.style.top="-5000px",o.style.opacity=0,o.onerror=t=>{console.error("图片加载失败"),this.$emit("error",{index:this.index,event:t,msg:"图片加载失败"}),this.clearCutImageObj()},o.onload=()=>{if(!0!==o.complete)throw new Error("图片加载失败");this.visible=!0,this.$nextTick((()=>{e((()=>{this.importImgToCanv(o)}))}))},o.src=t.src,this.cutImageObj=o,document.body.appendChild(o),this.$emit("onChooseImg",t,this.index)}}else this.visible=!0,this.$nextTick((()=>{e()}))},handleClose(){this.clearAll(),!0===this.isModal&&(!0===this.lockScroll&&(document.body.style.overflowY="scroll"),this.$nextTick((()=>{this.visible=!1})))},chooseImg(){this.$refs.inputFile.click()},importImgToCanv(t){const e=t.height,o=t.width,i=this.boxWidth,s=this.boxHeight;let a;const r={...this.drawImg};this.fileName=t.name,r.img=t,this.scaleImg.rate=o/e,e<s&&o<i?(a=1,r.x=(i-o)/2,r.y=(s-e)/2):o/e<=i/s?(a=s/e,r.x=(i-o*a)/2):(a=i/o,r.y=(s-e*a)/2),r.swidth=o,r.sheight=e,r.width=o*a,r.height=e*a,r.x=(i-r.width)/2,r.y=(s-r.height)/2,this.drawImg=r,this.printImg(),this.putToolBox()},putImgToCanv(t){let e;if(!t.target.files)return console.error("IE9及以下需要自己传入image对象"),!1;if(e=t.target.files[0]||null,e){this.fileName=e.name;const t=new FileReader;t.readAsDataURL(e),t.onload=o=>{const i=o.target.result,s=document.createElement("img");s.src=i;const a=setInterval((()=>{if(2===t.readyState){if(clearInterval(a),!this.sizeChange&&this.smallToUpload&&s.width<=this.cutWidth&&s.height<=this.cutHeight)return this.handleClose(),e.name=this.changeFileName(e.name,this.fileType),void this.$emit("cutDown",{filename:this.changeFileName(e.name,this.fileType),file:e,index:this.index});const t=s.height,o=s.width,i=this.boxWidth,r=this.boxHeight;let n;const l={...this.drawImg};l.img=s,this.scaleImg.rate=o/t,t<r&&o<i?(n=1,l.x=(i-o)/2,l.y=(r-t)/2):o/t<=i/r?(n=r/t,l.x=(i-o*n)/2):(n=i/o,l.y=(r-t*n)/2),l.swidth=o,l.sheight=t,l.width=o*n,l.height=t*n,l.x=(i-l.width)/2,l.y=(r-l.height)/2,this.drawImg=l,this.printImg(),this.putToolBox()}}),200)},this.$emit("onChooseImg",e,this.index)}},putToolBox(){this.toolBox.width!==this.boxWidth/2&&this.toolBox.height!==this.boxHeight/2&&!1!==this.saveCutPosition||(this.toolBox.width=this.cutWidth>this.boxWidth?this.boxWidth:this.cutWidth,this.toolBox.height=this.cutHeight>this.boxHeight?this.boxHeight:this.cutHeight),(0===this.toolBox.x&&0===this.toolBox.y||!1===this.saveCutPosition)&&(this.toolBox.x=this.boxWidth/2-this.toolBox.width/2,this.toolBox.y=this.boxHeight/2-this.toolBox.height/2),this.checkToolBoxOverflow().then((()=>{this.printImg()})),this.drawControlBox(this.toolBox.width,this.toolBox.height,this.toolBox.x,this.toolBox.y)},checkToolBoxOverflow(){return new Promise((t=>{if(!this.toolBoxOverflow){if(this.drawImg.width<this.toolBox.width||this.drawImg.height<this.toolBox.height){const t=this.drawImg.width/this.drawImg.height;this.drawImg.width<this.toolBox.width&&(this.drawImg.width=this.toolBox.width,this.drawImg.height=this.drawImg.width/t),this.drawImg.height<this.toolBox.height&&(this.drawImg.height=this.toolBox.height,this.drawImg.width=this.drawImg.height*t),this.drawImg.x=(this.boxWidth-this.drawImg.width)/2,this.drawImg.y=(this.boxHeight-this.drawImg.height)/2}console.log("this.drawImg.y > this.toolBox.y",this.drawImg.y+this.drawImg.height,this.toolBox.y+this.toolBox.height),this.drawImg.x>this.toolBox.x&&(this.drawImg.x=this.toolBox.x),this.drawImg.x+this.drawImg.width<this.toolBox.x+this.toolBox.width&&(this.drawImg.x=this.toolBox.x+this.toolBox.width-this.drawImg.width),this.drawImg.y>this.toolBox.y&&(this.drawImg.y=this.toolBox.y),this.drawImg.y+this.drawImg.height<this.toolBox.y+this.toolBox.height&&(this.drawImg.y=this.toolBox.y+this.toolBox.height-this.drawImg.height)}t()}))},isSupportFileApi(){return!(!(window.File&&window.FileList&&window.FileReader&&window.Blob)||navigator.userAgent.includes("Edge")||navigator.userAgent.includes("MSIE")||navigator.userAgent.includes("Trident"))},dataURLtoFile(t,e){const o=t.split(","),i=o[0].match(/:(.*?);/)[1],s=atob(o[1]);let a=s.length;const r=new Uint8Array(a);while(a--)r[a]=s.charCodeAt(a);if(this.isSupportFileApi()){const t=new File([r],e,{type:i});return t}return"不支持File对象"},clearAll(){const t=this,e=t.$refs.canvas,o=e.getContext("2d");o.clearRect(0,0,e.width,e.height);const i=t.$refs.canvasSelectBox,s=i.getContext("2d");s.clearRect(0,0,i.width,i.height);const a=t.drawImg.sx,r=t.drawImg.sy;this.drawImg={img:null,sx:a,sy:r,swidth:0,sheight:0,x:0,y:0,width:0,height:0},this.isFlipHorizontal=!1,this.isFlipVertically=!1,this.$refs.inputFile.value="",this.rotateImg.angle=0,this.drawImg.img=null,this.turnReset(),this.clearCutImageObj(),this.$emit("onClearAll",this.index)},clearCutImageObj(){null!==this.cutImageObj&&void 0!==this.cutImageObj&&("function"===typeof this.cutImageObj.remove?this.cutImageObj.remove():this.cutImageObj.removeNode()),this.cutImageObj=null},drawControlBox(t,e,o,i){this.toolBoxOverflow||(t<1&&(t=1),e<1&&(e=1),t>this.drawImg.width&&(t=this.drawImg.width),e>this.drawImg.height&&(e=this.drawImg.height),o<this.drawImg.x&&(o=this.drawImg.x),i<this.drawImg.y&&(i=this.drawImg.y),o>this.drawImg.x+this.drawImg.width-t&&(o=this.drawImg.x+this.drawImg.width-t),i>this.drawImg.y+this.drawImg.height-e&&(i=this.drawImg.y+this.drawImg.height-e)),t>this.boxWidth&&(t=this.boxWidth),e>this.boxHeight&&(e=this.boxHeight),o<0&&(o=0),i<0&&(i=0);const s=this.$refs.toolBoxControl,a=this.$refs.canvasSelectBox,r=a.getContext("2d");let n,l;if(r.fillStyle=this.selectBoxColor,r.clearRect(0,0,a.width,a.height),r.fillRect(0,0,a.width,a.height),this.rate&&""!==this.rate){const o=this.rate.split(":")[0]/this.rate.split(":")[1];o>=1?(n=t,l=t/o,l+i>this.drawImg.y+this.drawImg.height&&(l=this.drawImg.y+this.drawImg.height-i,n=l*o)):(n=e*o,l=e)}else n=t,l=e;this.toolBox.width=Math.abs(n),this.toolBox.height=Math.abs(l),s.style.width=`${Math.abs(n)}px`,s.style.height=`${Math.abs(l)}px`,this.toolBox.boxMove.moveTo.x=o,this.toolBox.boxMove.moveTo.y=i,n<0&&(o+=n),l<0&&(i+=l),o+this.toolBox.width>this.boxWidth&&(o=this.boxWidth-this.toolBox.width),o<0&&(o=0),i+this.toolBox.height>this.boxHeight&&(i=this.boxHeight-this.toolBox.height),i<0&&(i=0),this.toolBoxPosition.x=o,this.toolBoxPosition.y=i,s.style.left=`${o}px`,s.style.top=`${i}px`,r.clearRect(o,i,Math.abs(n),Math.abs(l)),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)},resetToolBox(){this.toolBox.width<0&&(this.toolBox.boxMove.moveTo.x=this.toolBox.x-this.toolBox.width),this.toolBox.height<0&&(this.toolBox.boxMove.moveTo.y=this.toolBox.y-this.toolBox.height),this.toolBox.width=Math.abs(this.toolBox.width),this.toolBox.height=Math.abs(this.toolBox.height)},toolBoxMouseDown(t){const e=this.$refs.toolBoxControl;this.toolBox.x=parseInt(e.style.left.split("px")[0]),this.toolBox.y=parseInt(e.style.top.split("px")[0]),this.toolBox.disable=!1,this.dropImg.active=!1,this.toolBox.boxMove.start={x:t.pageX,y:t.pageY}},toolBoxMouseMove(t){if(this.dropImg.active&&this.dropImgMove(t),!1===this.toolBox.disable&&!0===this.moveAble){const e=t.pageX-this.toolBox.boxMove.start.x,o=t.pageY-this.toolBox.boxMove.start.y,i=this.toolBox.x+e,s=this.toolBox.y+o;this.drawControlBox(this.toolBox.width,this.toolBox.height,i,s)}},toolBoxMouseLeave(){this.toolBox.disable=!0,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100),this.resetToolBox()},toolBoxMouseUp(){this.toolBox.x=parseInt(this.toolBoxPosition.x),this.toolBox.y=parseInt(this.toolBoxPosition.y),this.toolBox.disable=!0,this.dropImg.active=!1,this.resetToolBox()},printImg(){if(this.drawImg.img){const t=this.$refs.canvas,e=t.getContext("2d");e.font="18px bold 黑体",e.fillStyle="#ff0",e.textAlign="center",e.textBaseline="middle",e.save(),e.clearRect(0,0,t.width,t.height),e.translate(this.drawImg.x+this.drawImg.width/2,this.drawImg.y+this.drawImg.height/2),e.rotate(this.rotateImg.angle*Math.PI/180),e.translate(-(this.drawImg.x+this.drawImg.width/2),-(this.drawImg.y+this.drawImg.height/2)),e.translate(this.drawImg.x,this.drawImg.y),e.scale(this.isFlipHorizontal?-1:1,this.isFlipVertically?-1:1),e.drawImage(this.drawImg.img,this.drawImg.sx,this.drawImg.sy,this.drawImg.swidth,this.drawImg.sheight,this.isFlipHorizontal?-this.drawImg.width:0,this.isFlipVertically?-this.drawImg.height:0,this.drawImg.width,this.drawImg.height),e.translate(-this.drawImg.x,this.drawImg.y),e.restore(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)}},dropImgOn(t){!0===this.imgMove&&(this.dropImg.active=!0,this.dropImg.params={...this.drawImg},this.dropImg.pageX=t.pageX,this.dropImg.pageY=t.pageY)},dropImgOff(){this.dropImg.active=!1,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)},dropImgMove(t){if(this.dropImg.active&&this.drawImg.img){const e={...this.drawImg};e.x=this.dropImg.params.x-(this.dropImg.pageX-t.pageX),e.y=this.dropImg.params.y-(this.dropImg.pageY-t.pageY),this.toolBoxOverflow||(e.x>this.toolBox.x&&(e.x=this.toolBox.x),e.x<this.toolBox.x+this.toolBox.width-e.width&&(e.x=this.toolBox.x+this.toolBox.width-e.width),e.y>this.toolBox.y&&(e.y=this.toolBox.y),e.y<this.toolBox.y+this.toolBox.height-e.height&&(e.y=this.toolBox.y+this.toolBox.height-e.height)),this.drawImg=e,this.printImg(),t.stopPropagation()}},scaleReset(){this.drawImg.width=this.drawImg.swidth,this.drawImg.height=this.drawImg.sheight,this.printImg()},scaleImgWheel(t){if(this.drawImg.img&&!0===this.scaleAble){let e;const o=t||window.event;o.wheelDelta?e=-o.wheelDelta/40:o.detail&&(e=o.detail);const i=50;this.drawImg.x=this.drawImg.width-9*e>i?this.drawImg.x+3*e:this.drawImg.x,this.drawImg.y=this.drawImg.width-9*e>i?this.drawImg.y+3*e:this.drawImg.y,this.drawImg.width=this.drawImg.width-9*e>i?this.drawImg.width-9*e:i,this.drawImg.height=this.drawImg.width/this.scaleImg.rate,this.checkToolBoxOverflow().then((()=>{this.printImg(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)}))}return t.preventDefault(),t.returnValue=!1,!1},flipHorizontal(){this.drawImg.img&&(0==this.isFlipHorizontal?this.isFlipHorizontal=!0:this.isFlipHorizontal=!1,this.printImg())},flipVertically(){this.drawImg.img&&(0==this.isFlipVertically?this.isFlipVertically=!0:this.isFlipVertically=!1,this.printImg())},turnImg(t){const e=this.rotateImg.angle,o=e+t;o>=-180&&o<=180&&(this.rotateImg.angle=o,this.rotateControl.position=o/180*100+100,this.printImg("rotate"))},autoTurnImg(t){const e=this.rotateImg.angle,o=e+t;o>=-180&&o<=180&&(this.rotateImg.angle=o,this.rotateControl.position=o/180*100+100,this.printImg("rotate"))},turnReset(){this.rotateImg.angle=0,this.rotateControl.position=100,this.printImg("rotate")},controlBtnMouseDown(t,e){this.controlBox.disable=!1,this.controlBox.btnName=e,this.controlBox.start.x=t.clientX,this.controlBox.start.y=t.clientY,this.controlBox.start.width=this.toolBox.width,this.controlBox.start.height=this.toolBox.height,t.stopPropagation()},controlBtnMouseUp(t){this.controlBox.disable=!0,this.dropImgOff(),this.resetToolBox(),this.toolBoxMouseUp(),t.stopPropagation()},controlBtnMouseMove(t){if(!1===this.controlBox.disable){const e=t.clientX-this.controlBox.start.x,o=t.clientY-this.controlBox.start.y;let i,s;if("leftUp"==this.controlBox.btnName){if(this.rate){const t=this.rate.split(":")[0]/this.rate.split(":")[1];t>=1?(i=this.toolBox.x+e,s=this.toolBox.y+e/t):(i=this.toolBox.x+o*t,s=this.toolBox.y+o)}else i=this.toolBox.x+e,s=this.toolBox.y+o;this.toolBox.width=this.controlBox.start.width-e,this.toolBox.height=this.controlBox.start.height-o}if("rightUp"==this.controlBox.btnName){if(this.rate){const t=this.rate.split(":")[0]/this.rate.split(":")[1];t>=1?(i=this.toolBox.x,s=this.toolBox.y-e/t):(i=this.toolBox.x,s=this.toolBox.y+o)}else i=this.toolBox.x,s=this.toolBox.y+o;this.toolBox.width=this.controlBox.start.width+e,this.toolBox.height=this.controlBox.start.height-o}if("rightDown"==this.controlBox.btnName&&(i=this.toolBox.x,s=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+e,this.toolBox.height=this.controlBox.start.height+o),"leftDown"==this.controlBox.btnName){if(this.rate){const t=this.rate.split(":")[0]/this.rate.split(":")[1];t>=1?(i=this.toolBox.x+e,s=this.toolBox.y):(i=this.toolBox.x+-o*t,s=this.toolBox.y)}else i=this.toolBox.x+e,s=this.toolBox.y;this.toolBox.width=this.controlBox.start.width-e,this.toolBox.height=this.controlBox.start.height+o}"topCenter"==this.controlBox.btnName&&(i=this.toolBox.x,s=this.toolBox.y+o,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height-o),"downCenter"==this.controlBox.btnName&&(i=this.toolBox.x,s=this.toolBox.y,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height+o),"leftCenter"==this.controlBox.btnName&&(i=this.toolBox.x+e,s=this.toolBox.y,this.toolBox.width=this.controlBox.start.width-e,this.toolBox.height=this.controlBox.start.height),"rightCenter"==this.controlBox.btnName&&(i=this.toolBox.x,s=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+e,this.toolBox.height=this.controlBox.start.height),this.drawControlBox(this.toolBox.width,this.toolBox.height,i,s)}t.stopPropagation()},changeFileName(t,e){const o=t.lastIndexOf(".");return t.substr(0,o+1)+("jpeg"===e?"jpg":e)},cropPicture(t){const e=this;if(this.drawImg.img){const o=this.$refs.canvas;if(this.WatermarkText&&!t){const t=o.getContext("2d");t.font=this.WatermarkTextFont,t.fillStyle=this.WatermarkTextColor,t.textAlign="right",t.textBaseline="bottom",t.fillText(this.WatermarkText,this.toolBox.x+this.toolBox.width*this.WatermarkTextX,this.toolBox.y+this.toolBox.height*this.WatermarkTextY)}const i=new Image;!0===this.crossOrigin&&(i.crossOrigin=this.crossOriginHeader),i.src=o.toDataURL(`image/${this.fileType}`),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:(t,i,s)=>{window.atob?setTimeout((()=>{const a=atob(o.toDataURL(i,s).split(",")[1]),r=a.length,n=new Uint8Array(r);let l;for(let t=0;t<r;t++)n[t]=a.charCodeAt(t);try{l=new Blob([n],{type:`image/${e.fileType}`})}catch(h){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"==h.name&&window.BlobBuilder){const t=window.BlobBuilder,o=new t;o.append(n.buffer),l=o.getBlob(`image/${e.fileType}`)}"InvalidStateError"==h.name&&(l=new Blob([n.buffer],{type:`image/${e.fileType}`}))}t(l)}),200):t(!1,{type:`image/${e.fileType}`})}}),o.toBlob((o=>{if(o){const s=new FileReader;s.readAsDataURL(o),s.onload=()=>{const o=setInterval((()=>{if(2==s.readyState){clearInterval(o);const s=document.createElement("canvas"),a=s.getContext("2d");if(1==e.originalGraph){const t=e.drawImg.width/e.drawImg.swidth,o=e.toolBox.width/t,i=e.toolBox.height/t;s.width=o,s.height=i;const r=(e.toolBox.x-e.drawImg.x)/t,n=(e.toolBox.y-e.drawImg.y)/t,l=e.drawImg.swidth,h=e.drawImg.sheight;a.translate(-r,-n),a.drawImage(e.drawImg.img,0,0,l,h)}else{s.width=e.toolBox.width,s.height=e.toolBox.height;const t=e.toolBox;if(e.rate){const o=e.rate.split(":")[0]/e.rate.split(":")[1],s=e.rate.split(":")[0],r=e.rate.split(":")[1];s>=r?a.drawImage(i,t.x,t.y,t.width,t.width*o,0,0,t.width,t.width*o):a.drawImage(i,t.x,t.y,t.width,t.width/o,0,0,t.width,t.width/o)}else a.drawImage(i,t.x,t.y,t.width,t.height,0,0,t.width,t.height)}s.toBlob((o=>{const i=e.changeFileName(e.fileName,e.fileType);t?e.previewMode&&e.$emit("onPrintImg",{index:e.index,fileName:i,blob:o,file:e.dataURLtoFile(s.toDataURL(`image/${e.fileType}`),i),dataURL:s.toDataURL(`image/${e.fileType}`)}):(e.handleClose(),e.$emit("cutDown",{index:e.index,fileName:i,blob:o,file:e.dataURLtoFile(s.toDataURL(`image/${e.fileType}`),i),dataURL:s.toDataURL(`image/${e.fileType}`)}))}),`image/${e.fileType}`,.95)}}),200)}}else{const o=document.createElement("canvas");o.width=e.toolBox.width,o.height=e.toolBox.height;const s=o.getContext("2d"),a=e.toolBox;if(e.rate){const t=e.rate.split(":")[0]/e.rate.split(":")[1];s.drawImage(i,a.x,a.y,a.width,a.width*t,0,0,a.width,a.width*t)}else s.drawImage(i,a.x,a.y,a.width,a.height,0,0,a.width,a.height);const r=e.changeFileName(e.fileName,e.fileType);t?e.$emit("onPrintImg",{fileName:r,dataURL:o.toDataURL(`image/${e.fileType}`)}):(e.handleClose(),e.$emit("cutDown",{fileName:r,dataURL:o.toDataURL(`image/${e.fileType}`)}))}})),e.fileType}else t||(console.warn("No picture selected"),e.$emit("error",{err:1,msg:"No picture selected"}))},scrollBarControlMove(t){if(this.rotateControl.active){const e=t.pageX-this.rotateControl.start.x;let o=this.rotateControl.start.position+e;o<=0&&(o=0),o>=200&&(o=200),this.rotateControl.position=o,this.rotateImg.angle=(o-100)/100*180,this.printImg()}},scrollBarControlOn(t){this.rotateControl.active=!0,this.rotateControl.start.x=t.pageX,this.rotateControl.start.y=t.pageY,this.rotateControl.start.position=this.rotateControl.position},scrollBarControlOff(){this.rotateControl.active=!1}}},f=w,I=o(8e3),B=(0,I.Z)(f,u,p,!1,null,"35891e32",null),v=B.exports,y=v,b={name:"SmartCrop",components:{ImgCutter:y},model:{prop:"smartCropModalVal",event:"input"},props:["smartCropModalVal"],data(){return{showModal:!1,autoRotate:0,cutdownImgPreviewSrc:"",loading:!1}},watch:{smartCropModalVal(t){this.showModal=t},showModal(t){t&&this.$store.state.currentMainPreviewImgName&&(this.$refs.imgCutterModal.handleOpen({name:this.$store.state.currentMainPreviewImgName,src:this.getCurrentImgSrc}),this.$refs.cancelButton.$el.removeAttribute("disabled"),this.$refs.cropButton.$el.removeAttribute("disabled"),this.$refs.autoRotateButton.$el.removeAttribute("disabled"))}},computed:{...(0,m.rn)(["currentMainPreviewImgName"]),...(0,m.Se)(["getCurrentImgSrc"])},mounted(){this.showModal=this.smartCropModalVal},methods:{handleVisibleChange(t){if(!1===t&&(this.$emit("input",t),this.autoRotate=0,this.$refs.cancelButton.$el.click(),this.cutdownImgPreviewSrc=""),!0===t)try{this.cutdownImgPreviewSrc=this.getCurrentImgSrc}catch(e){console.log()}},calcAng(t,e){if(e.y<=t.y&&e.x>=t.x){const o=Math.atan((t.y-e.y)/(e.x-t.x)),i=180*o/Math.PI;return i}if(e.y>=t.y&&t.x<e.x){const o=Math.atan((e.y-t.y)/(e.x-t.x)),i=180*o/Math.PI;return-i}},async loadModel(){await g.qB.ssdMobilenetv1.loadFromUri("/models/"),await g.qB.faceLandmark68Net.loadFromUri("/models/")},async smartRotate(){try{if(""===this.cutdownImgPreviewSrc)throw new Error("没有选择图片");const t=new Image;t.src=this.cutdownImgPreviewSrc,this.loading=!0,await this.loadModel();const e=await g.bd(t).withFaceLandmarks(),o=e.landmarks,i=o.positions[36],s=o.positions[45];this.autoRotate=this.calcAng(i,s),this.loading=!1,this.$Message.success("自动矫正处理成功"),this.$refs.autoRotateButton.$el.setAttribute("disabled","false")}catch(t){this.$Message.error("处理失败")}},cutDown(t){const e=document.createElement("img");e.setAttribute("width","160px"),e.setAttribute("height","225px"),e.src=t.dataURL,this.$refs.previewimg.appendChild(e),this.$refs.cancelButton.$el.setAttribute("disabled","true"),this.$refs.cropButton.$el.setAttribute("disabled","true"),this.$refs.autoRotateButton.$el.setAttribute("disabled","true")},printImg(t){let e=this.$refs.previewimg.firstChild;e||(e=document.createElement("img"),e.setAttribute("width","160px"),e.setAttribute("height","225px"),e.src=t.dataURL,this.$refs.previewimg.appendChild(e)),e.src=t.dataURL},clearImg(){const t=this.$refs.previewimg.firstChild;t&&t.remove(),this.cutdownImgPreviewSrc="",this.$refs.cancelButton.$el.setAttribute("disabled","true"),this.$refs.cropButton.$el.setAttribute("disabled","true"),this.$refs.autoRotateButton.$el.setAttribute("disabled","true")},error(t){"No picture selected"===t.msg&&this.$Message.error("未选择图片")},saveCropedImg(){const t=this.$refs.previewimg.firstChild;t?(this.$store.dispatch("updateImgData",{imgName:this.currentMainPreviewImgName,imgSrc:t.src}),this.$Message.success("保存修改成功")):this.$Message.error("未进行任何修改")},closeModal(){""!==this.currentMainPreviewImgName&&this.$Message.warning("未进行任何修改！")}}},C=b,M=(0,I.Z)(C,d,c,!1,null,"64bc6e89",null),_=M.exports,$=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("Modal",{attrs:{draggable:"",sticky:"","reset-drag-position":!0,mask:!1,width:600,title:"智能替换背景","ok-text":"保存修改","cancel-text":"取消修改"},on:{"on-visible-change":t.handleVisibleChange,"on-ok":t.saveReplacedImg,"on-cancel":t.closeModal},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[t.getCurrentImgSrc?o("div",{staticClass:"background-replace"},[o("div",{staticClass:"left"},[o("img",{attrs:{src:t.getCurrentImgSrc,alt:"",width:"200",height:"280"}})]),o("div",{staticClass:"middle"},[o("canvas",{ref:"canvas",attrs:{id:"canvas",width:"200",height:"280"}})]),t.getCurrentImgSrc?o("div",{staticClass:"right"},[o("Button",{attrs:{type:"primary"},on:{click:function(e){return t.replaceBgColor("blue")}}},[t._v(" 换蓝色背景 ")]),o("Button",{attrs:{type:"error"},on:{click:function(e){return t.replaceBgColor("red")}}},[t._v(" 换红色背景 ")]),o("Button",{attrs:{type:"text"},on:{click:function(e){return t.replaceBgColor("white")}}},[t._v(" 换白色背景 ")])],1):t._e()]):o("h3",[t._v(" 请先选择图片 ")])])},T=[],D=o(6090),k=o.n(D),N=o(9327),S=o.n(N),P={api_key:"5Tv5VWWBYtPNtkB2c4l3MPbePwtg1qtx",api_secret:"_NlDutPsgZ6HmG_y_bO4It6_Bj8IXlTA",image_base64:"",return_grayscale:0},O={name:"BackgroundReplace",model:{prop:"backgroundReplaceModalVal",event:"input"},props:["backgroundReplaceModalVal"],data(){return{showModal:!1}},watch:{backgroundReplaceModalVal(t){this.showModal=t},currentMainPreviewImgName(){this.$refs.canvas&&this.$refs.canvas.getContext("2d").clearRect(0,0,200,280)}},mounted(){this.showModal=this.backgroundReplaceModalVal},computed:{...(0,m.rn)(["currentMainPreviewImgName"]),...(0,m.Se)(["getCurrentImgSrc"])},methods:{handleVisibleChange(t){t||this.$emit("input",t)},closeModal(){""!==this.currentMainPreviewImgName&&this.$Message.warning("未进行任何修改！")},saveReplacedImg(){if(this.$refs.canvas&&!this.isCanvasBlank(this.$refs.canvas)){const t=this.$refs.canvas,e=t.toDataURL();this.$store.dispatch("updateImgData",{imgName:this.currentMainPreviewImgName,imgSrc:e}),this.$Message.success("背景替换成功"),this.$refs.canvas&&this.$refs.canvas.getContext("2d").clearRect(0,0,200,280)}else this.$Message.error("未进行任何修改！")},isCanvasBlank(t){const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.toDataURL()===e.toDataURL()},async requestFacePP(){try{P.image_base64=this.getCurrentImgSrc;const t=await k()({url:"https://api-cn.faceplusplus.com/humanbodypp/v2/segment",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:S().stringify(P)});if(200===t.status)return t.data.body_image;throw new Error("背景替换失败")}catch(t){this.$Message.error("背景替换失败")}finally{P.image_base64=""}},async replaceBgColor(t){let e="";switch(t){case"blue":e="#00BFF3";break;case"red":e="#FF0000";break;case"white":e="#FFFFFF";break}const o=await this.requestFacePP(),i=`data:image/png;base64,${o}`,s=new Image;s.src=i,s.width=200,s.height=280,s.onload=()=>{const t=this.$refs.canvas,o=t.getContext("2d");o.fillStyle=e,o.fillRect(0,0,200,280),o.drawImage(s,0,0,200,280)}}}},R=O,F=(0,I.Z)(R,$,T,!1,null,"df7af7ac",null),A=F.exports,L={components:{SmartCrop:_,BackgroundReplace:A},data(){return{accept:"image/jpeg,image/jpg,image/png",smartCropModalVal:!1,backgroundReplaceModalVal:!1}},methods:{loadImg(t){const e=new FileReader;return e.readAsDataURL(t),e.onload=e=>{this.$store.dispatch("addImgData",{imgName:t.name,imgSrc:e.target.result}),this.$store.dispatch("changeCurrentImg",t.name),this.$refs.upload.clearFiles()},!1},handleFormatError(){console.log("文件不是图片")},resetCurrentImg(){""===this.$store.state.currentMainPreviewImgName?this.$Message.error("没有要重置的图片"):(this.$store.dispatch("resetCurrentImg"),this.$Message.success("重置成功！"))},exportImg(){const t=this.$store.getters.getCurrentImgSrc;if(t){const e=document.createElement("a"),o=new MouseEvent("click");e.download="导出.png",e.href=t,e.dispatchEvent(o)}else this.$Message.error("未选择图片")}}},U=L,H=(0,I.Z)(U,l,h,!1,null,"476914cb",null),E=H.exports,W=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("Layout",{staticClass:"main"},[o("Sider",{staticClass:"sider",attrs:{"hide-trigger":""}},[o("SiderPreviewCard")],1),o("Content",{staticClass:"content"},[o("MainPreviewCard")],1)],1)},V=[],q=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",t._l(t.OriginImgData,(function(e){return o("Card",{key:e.imgName,staticClass:"card",attrs:{padding:5}},[o("div",{staticClass:"preview-img",staticStyle:{"text-align":"center"},on:{click:function(o){return t.changeMainPreview(e.imgName)}}},[o("img",{attrs:{src:e.imgSrc}})]),o("Tooltip",{staticClass:"remove-img",attrs:{content:"点击删除此照片",placement:"right",theme:"light"}},[o("Button",{attrs:{type:"text",size:"large",icon:"ios-trash"},on:{click:function(o){return t.removeImg(e.imgName)}}})],1)],1)})),1)},j=[],z={name:"PreviewCard",computed:{...(0,m.rn)(["OriginImgData"]),OriginImgDataList(){return this.OriginImgData?this.OriginImgData:[]}},methods:{removeImg(t){this.$store.dispatch("removeImg",t)},changeMainPreview(t){this.$store.dispatch("changeCurrentImg",t)}}},G=z,Y=(0,I.Z)(G,q,j,!1,null,"d843d828",null),X=Y.exports,Z=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"show-img"}},[0!=t.ModifiedImgData.length?o("img",{attrs:{src:t.getCurrentImgSrc,alt:""}}):t._e()])},J=[],K={name:"MainPreviewCard",computed:{...(0,m.rn)(["ModifiedImgData"]),...(0,m.Se)(["getCurrentImgSrc"])}},Q=K,tt=(0,I.Z)(Q,Z,J,!1,null,"49758519",null),et=tt.exports,ot={components:{SiderPreviewCard:X,MainPreviewCard:et}},it=ot,st=(0,I.Z)(it,W,V,!1,null,"4ba4d24c",null),at=st.exports,rt={components:{HeaderView:E,MainView:at}},nt=rt,lt=(0,I.Z)(nt,r,n,!1,null,"f8b444ba",null),ht=lt.exports;i["default"].use(m.ZP);var dt=new m.ZP.Store({state:{OriginImgData:JSON.parse(localStorage.getItem("OriginImgData"))||[],ModifiedImgData:JSON.parse(localStorage.getItem("ModifiedImgData"))||[],currentMainPreviewImgName:localStorage.getItem("currentMainPreviewImgName")||""},getters:{getCurrentImgSrc(t){return t.ModifiedImgData.length>0?t.ModifiedImgData.find((e=>e.imgName===t.currentMainPreviewImgName)).imgSrc:""}},mutations:{ADD_IMG_DATA(t,e){t.OriginImgData.push(e),t.ModifiedImgData.push(e),localStorage.setItem("OriginImgData",JSON.stringify(t.OriginImgData)),localStorage.setItem("ModifiedImgData",JSON.stringify(t.ModifiedImgData))},RM_IMG_DATA(t,e){t.OriginImgData.length>1?(t.OriginImgData=t.OriginImgData.filter((t=>t.imgName!==e)),t.ModifiedImgData=t.ModifiedImgData.filter((t=>t.imgName!==e)),t.currentMainPreviewImgName===e&&(t.currentMainPreviewImgName=t.OriginImgData[t.OriginImgData.length-1].imgName),localStorage.setItem("OriginImgData",JSON.stringify(t.OriginImgData)),localStorage.setItem("ModifiedImgData",JSON.stringify(t.ModifiedImgData)),localStorage.setItem("currentMainPreviewImgName",t.currentMainPreviewImgName)):(t.OriginImgData=[],t.ModifiedImgData=[],t.currentMainPreviewImgName="",localStorage.removeItem("OriginImgData"),localStorage.removeItem("ModifiedImgData"),localStorage.removeItem("currentMainPreviewImgName"))},UPDATE_IMG_DATA(t,e){const o=t.ModifiedImgData.findIndex((t=>t.imgName===e.imgName));t.ModifiedImgData.splice(o,1,e),localStorage.setItem("ModifiedImgData",JSON.stringify(t.ModifiedImgData))},CHANGE_CURRENT_IMG(t,e){t.currentMainPreviewImgName=e,localStorage.setItem("currentMainPreviewImgName",t.currentMainPreviewImgName)},RESET_CURRENT_IMG(t){if(t.ModifiedImgData.length>0){const e=t.OriginImgData.find((e=>e.imgName===t.currentMainPreviewImgName)),o=t.ModifiedImgData.findIndex((e=>e.imgName===t.currentMainPreviewImgName));t.ModifiedImgData.splice(o,1,e)}localStorage.setItem("ModifiedImgData",JSON.stringify(t.ModifiedImgData))}},actions:{addImgData({commit:t},e){t("ADD_IMG_DATA",e)},updateImgData({commit:t},e){t("UPDATE_IMG_DATA",e)},changeCurrentImg({commit:t},e){t("CHANGE_CURRENT_IMG",e)},removeImg({commit:t},e){t("RM_IMG_DATA",e)},resetCurrentImg({commit:t}){t("RESET_CURRENT_IMG")}},modules:{}});i["default"].use(a()),i["default"].config.productionTip=!1,new i["default"]({store:dt,render:t=>t(ht)}).$mount("#app")},9771:function(){},3050:function(){},8450:function(){}},e={};function o(i){var s=e[i];if(void 0!==s)return s.exports;var a=e[i]={exports:{}};return t[i].call(a.exports,a,a.exports,o),a.exports}o.m=t,function(){var t=[];o.O=function(e,i,s,a){if(!i){var r=1/0;for(d=0;d<t.length;d++){i=t[d][0],s=t[d][1],a=t[d][2];for(var n=!0,l=0;l<i.length;l++)(!1&a||r>=a)&&Object.keys(o.O).every((function(t){return o.O[t](i[l])}))?i.splice(l--,1):(n=!1,a<r&&(r=a));if(n){t.splice(d--,1);var h=s();void 0!==h&&(e=h)}}return e}a=a||0;for(var d=t.length;d>0&&t[d-1][2]>a;d--)t[d]=t[d-1];t[d]=[i,s,a]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};o.O.j=function(e){return 0===t[e]};var e=function(e,i){var s,a,r=i[0],n=i[1],l=i[2],h=0;if(r.some((function(e){return 0!==t[e]}))){for(s in n)o.o(n,s)&&(o.m[s]=n[s]);if(l)var d=l(o)}for(e&&e(i);h<r.length;h++)a=r[h],o.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return o.O(d)},i=self["webpackChunkidphotomaker"]=self["webpackChunkidphotomaker"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=o.O(void 0,[998],(function(){return o(625)}));i=o.O(i)})();
//# sourceMappingURL=app.6dbd6975.js.map